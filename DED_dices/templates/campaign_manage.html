{% extends 'base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/campaign_manage.css' %}">
<link rel="stylesheet" href="{% static 'css/chat.css' %}">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
{% endblock %}

{% block content %}
<header>
	<a class="back-button" href="/campaign_selection/"><</a>
	<a class="home-page" href="/">
		DED-dices
	</a>
</header>

<main>
    <div class="header">
        <h1>{{campaign.name}}</h1>
    </div>
    <div class="section_display">
        <div class="display_block">
            <h2>personagens</h2>
            <div class="block_content" id="players_display">
                {% for character in characters %}
                <a class="character" href="/play/{{character.id}}/">
                    <p>{{character.name}} - {{character.job}}</p>
                </a>
                {% endfor %}
            </div>
        </div>
        <div class="display_block">
            <h2>Chat</h2>
            <div class="block_content">
                <div id="chat_display"></div>

                <div id="chat_manager">
                    <div class="textInput">
                        <input type="text" name="response" id="inputResponse" maxlength="1000">
                        <button type="button" id="sendMessageButton">></div>
                    </div>
                    <div class="dices_manager">
                        <button type="button" class="dice" id="D4">D4</button>
                        <button type="button" class="dice" id="D6">D6</button>
                        <button type="button" class="dice" id="D8">D8</button>
                        <button type="button" class="dice" id="D10">D10</button>
                        <button type="button" class="dice" id="D12">D12</button>
                        <button type="button" class="dice" id="D20">D20</button>
                        <button type="button" class="dice" id="D100">D100</button>
                    </div>

                    {% csrf_token %}
                </div>
            </div>
        </div>
    </div>
    <div class="entity-manage">
        <h2>Gerenciador de entidades</h2>
        <div class="block_content" id="block_entity">
            <div class="your_entitys">
                <h3>Suas entidades</h3>
                <div class="your_entitys-display" id="entity_display">
                    {% for entity in entitys %}
                    <div class="entity">
                        <h4 class="entity-object" id="entity-{{entity.id}}">{{entity.name}}</h3>
                        <nav>
                            <a href="/entity_edit/{{entity.id}}/{{campaign.id}}/">Editar</a>
                            <a class="deleteToken" href="/entity_delete/{{entity.id}}/{{campaign.id}}/">Deletar</a>
                        </nav>

                        <input type="hidden" id="token-{{entity.id}}" value="{{entity.token}}">
                    </div>
                    {% endfor %}

                    <script>
                        $('.deleteToken').on('click', function(event) {
                            event.preventDefault()
                        
                            if (confirm("Tem certeza? Essa ação não pode ser desfeita.")) {
                                var link = $(this).attr('href')
                                window.location.href = link
                            }
                        });
                    </script>
                </div>
            </div>

            <div class="entity_token">
                <div class="entity-navbar">

                </div>
                <div class="entity_token-display" style="display: none">
                    <div class="first-page">
                        <div class="col-1">
                            <div class="modifier">
                                <p id="_strength">Força</p>
                                <input type="number" name="strength_modifier" value="{{atributes.strength_modifier}}" class="modifier-input" readonly id="strength_modifier">
                            </div>
                
                            <div class="modifier">
                                <p id="_dexterity">Destreza</p>
                                <input type="number" name="dexterity_modifier" value="{{atributes.dexterity_modifier}}" class="modifier-input" readonly id="dexterity_modifier">
                            </div>
                
                            <div class="modifier">
                                <p id="_constituition">Constituição</p>
                                <input type="number" name="constituition_modifier" value="{{atributes.constituition_modifier}}" class="modifier-input" readonly id="constituition_modifier">
                            </div>
                
                            <div class="modifier">
                                <p id="_intelligence">Inteligência</p>
                                <input type="number" name="intelligence_modifier" value="{{atributes.intelligence_modifier}}" class="modifier-input" readonly id="intelligence_modifier">
                            </div>
                            
                            <div class="modifier">
                                <p id="_wisdom">Sabedoria</p>
                                <input type="number" name="wisdom_modifier" value="{{atributes.wisdom_modifier}}" class="modifier-input" readonly id="wisdom_modifier">
                            </div>
                            
                            <div class="modifier">
                                <p id="_charisma">Carisma</p>
                                <input type="number" name="charisma_modifier" value="{{atributes.charisma_modifier}}" class="modifier-input" readonly id="charisma_modifier">
                            </div>
                            
                        </div>

                        <div class="col-2">
                            <div class="body_statistics">
                                <div class="body_statistics-defined">
                                    <div class="body_statistic">
                                        <input type="number" name="ca" id="class_armor" value="{{characteristics.class_armor}}" required readonly>
                                        <p>CA</p>
                                    </div>
                                    <div class="body_statistic">
                                        <input type="number" name="iniciative" id="iniciative" value="{{characteristics.iniciative}}" required readonly>
                                        <p>Iniciativa</p>
                                    </div>
                                    <div class="body_statistic">
                                        <input type="number" name="displacement" id="displacement" value="{{characteristics.displacement}}" required readonly>
                                        <p>Deslocamento</p>
                                    </div>
                                    <div class="body_statistic">
                                        <input type="number" name="hp" id="hp" value="{{characteristics.hp}}" required>
                                        <p>HP</p>
                                    </div>
                                </div>
                                <div class="body_statistics-defined">
                                    <div class="body_statistic">
                                        <input type="number" name="class_armor_temp" id="ca-temp" value="{{characteristics.class_armor_temp}}" required>
                                        <p>CA - temp</p>
                                    </div>
                                    <div class="body_statistic">
                                        <input type="number" name="displacement_temp" id="displacement-temp" value="{{characteristics.displacement_temp}}" required>
                                        <p>Deslocamento - temp</p>
                                    </div>
                                    <div class="body_statistic">
                                        <input type="number" name="hp_temp" id="hp-temp" value="{{characteristics.hp_temp}}" required>
                                        <p>HP - temp</p>
                                    </div>
                                </div>
                            </div>
                
                            <div class="language_and_other_skills-field">
                                <textarea name="language_and_other_skills" readonly id="language_and_other_skills">{{characteristics.language_and_other_skills}}</textarea>
                                <p>Idiomas e outras proeficiências</p>
                            </div>
                
                            <div class="equipment-field">
                                <div class="equipment-content">
                                    <div class="money">
                                        <label class="money_category" for="pc">
                                            PC <input type="number" name="pc" id="pc" value="{{characteristics.pc}}">
                                        </label>
                                        <label class="money_category" for="pp">
                                            PP <input type="number" name="pp" id="pp" value="{{characteristics.pp}}">
                                        </label>
                                        <label class="money_category" for="po">
                                            PO <input type="number" name="po" id="po" value="{{characteristics.po}}">
                                        </label>
                                        <label class="money_category" for="pl">
                                            PL <input type="number" name="pl" id="pl" value="{{characteristics.pl}}">
                                        </label>
                                        <label class="money_category" for="da">
                                            DA <input type="number" name="da" id="da" value="{{characteristics.da}}">
                                        </label>
                                    </div>
                
                                    <textarea name="equipments" id="equipments">{{characteristics.equipments}}</textarea>
                                </div>
                
                                <p>Equipamentos</p>
                            </div>
                        </div>

                        <div class="col-3">
                            <div class="bonus">
                                <div class="inspiration">
                                    <input type="number" name="inspiration" value="{{skills.inspiration}}" id="inspiration">
                                    <p>Inspiração</p>
                                </div>
                                <div class="proeficiency">
                                    <input type="number" name="proeficiency" value="{{skills.proeficiency}}" readonly id="proeficiency">
                                    <p>Proeficiência</p>
                                </div>
                            </div>
                
                            <div class="saveguard">
                                <p>Testes de resistência</p>
                
                                <div class="saveguard-attribute">
                                    <input type="checkbox" name="strength_proeficiency" class="saveguard-input" id="strength" {% if skills.strength_proeficiency %}checked{% endif %}>
                                    <label for="strength">Força</label>
                                </div>
                                
                                <div class="saveguard-attribute">
                                    <input type="checkbox" name="dexterity_proeficiency" class="saveguard-input" id="dexterity" {% if skills.dexterity_proeficiency %}checked{% endif %}>
                                    <label for="dexterity">Destreza</label>
                                </div>
                                
                                <div class="saveguard-attribute">
                                    <input type="checkbox" name="constituition_proeficiency" class="saveguard-input" id="constituition" {% if skills.constituition_proeficiency %}checked{% endif %}>
                                    <label for="constituition">Constituição</label>
                                </div>
                                
                                <div class="saveguard-attribute">
                                    <input type="checkbox" name="intelligence_proeficiency" class="saveguard-input" id="intelligence" {% if skills.intelligence_proeficiency %}checked{% endif %}>
                                    <label for="intelligence">Inteligência</label>
                                </div>
                                
                                <div class="saveguard-attribute">
                                    <input type="checkbox" name="wisdom_proeficiency" class="saveguard-input" id="wisdom" {% if skills.wisdom_proeficiency %}checked{% endif %}>
                                    <label for="wisdom">Sabedoria</label>
                                </div>
                                
                                <div class="saveguard-attribute">
                                    <input type="checkbox" name="charisma_proeficiency" class="saveguard-input" id="charisma" {% if skills.charisma_proeficiency %}checked{% endif %}>
                                    <label for="charisma">Carisma</label>
                                </div>
                                
                            </div>
                
                            <div class="skills">
                                <p>Perícias</p>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="athletics_proeficiency" class="skill-input" id="athletics-strength" {% if skills.athletics_proeficiency %}checked{% endif %}>
                                    <label for="athletics">Atletismo - (For)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="stunt_proeficiency" class="skill-input" id="stunt-dexterity" {% if  skills.stunt_proeficiency %}checked{% endif %}>
                                    <label for="stunt">Acrobacia - (Des)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="stealth_proeficiency" class="skill-input" id="stealth-dexterity" {% if  skills.stealth_proeficiency %}checked{% endif %}>
                                    <label for="stealth">Furtividade - (Des)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="sleight_proeficiency" class="skill-input" id="sleight-dexterity" {% if  skills.sleight_proeficiency %}checked{% endif %}>
                                    <label for="sleight">Prestidigitação - (Des)</label>
                                </div>
                
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="arcana_proeficiency" class="skill-input" id="arcana-intelligence" {% if  skills.arcana_proeficiency %}checked{% endif %}>
                                    <label for="arcana">Arcanismo - (Int)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="history_proeficiency" class="skill-input" id="history-intelligence" {% if  skills.history_proeficiency %}checked{% endif %}>
                                    <label for="history">História - (Int)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="investigation_proeficiency" class="skill-input" id="investigation-intelligence" {% if  skills.investigation_proeficiency %}checked{% endif %}>
                                    <label for="investigation">Investigação - (Int)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="medicine_proeficiency" class="skill-input" id="medicine-intelligence" {% if  skills.medicine_proeficiency %}checked{% endif %}>
                                    <label for="medicine">Medicina - (Int)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="nature_proeficiency" class="skill-input" id="nature-intelligence" {% if  skills.nature_proeficiency %}checked{% endif %}>
                                    <label for="nature">Natureza - (Int)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="religion_proeficiency" class="skill-input" id="religion-intelligence" {% if  skills.religion_proeficiency %}checked{% endif %}>
                                    <label for="religion">Religião - (Int)</label>
                                </div>
                
                                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="acting_proeficiency" class="skill-input" id="acting-charisma" {% if  skills.acting_proeficiency %}checked{% endif %}>
                                    <label for="acting">Atuação - (Car)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="bluff_proeficiency" class="skill-input" id="bluff-charisma" {% if  skills.bluff_proeficiency %}checked{% endif %}>
                                    <label for="bluff">Blefar - (Car)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="intimidation_proeficiency" class="skill-input" id="intimidation-charisma" {% if  skills.intimidation_proeficiency %}checked{% endif %}>
                                    <label for="intimidation">Intimidação - (Car)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="intuition_proeficiency" class="skill-input" id="intuition-charisma" {% if  skills.intuition_proeficiency %}checked{% endif %}>
                                    <label for="intuition">Intuição - (Car)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="persuasion_proeficiency" class="skill-input" id="persuasion-charisma" {% if  skills.persuasion_proeficiency %}checked{% endif %}>
                                    <label for="persuasion">Persuasão - (Car)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="animal_proeficiency" class="skill-input" id="animal-wisdom" {% if  skills.animal_proeficiency %}checked{% endif %}>
                                    <label for="animal">Adestrar - (Sab)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="perception_proeficiency" class="skill-input" id="perception-wisdom" {% if  skills.perception_proeficiency %}checked{% endif %}>
                                    <label for="perception">Percepção - (Sab)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="survive_proeficiency" class="skill-input" id="survive-wisdom" {% if  skills.survive_proeficiency %}checked{% endif %}>
                                    <label for="survive">Sobrevivência - (Sab)</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="secound-page">
                        <div class="col-7">
                            <div class="physical_attacks">
                                <div class="attack-header">
                                    <h2>Ataques físicos</h2>
                                </div>
                                <div class="physical_attacks-field">
                                    {% for attack in attacks %}
                                    {% if attack.type == 'physical' %}
                                    <div class="attack" id="attack_physical_config-{{attack.id}}">
                                        <h2>{{attack.name}}</h2>
                                        <input type="hidden" id='attack_physical_data-{{attack.id}}' value='{"name": "{{attack.name}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                    </div>
                                    {% endif %}
                                    {% endfor %}
                                </div>
                                <input type="hidden" name="physical_attacks" value="">
                            </div>
                
                            <div class="magics_attacks">
                                <div class="attack-header">
                                    <h2>Ataques mágicos</h2>
                                </div>
                                <div class="magic_attacks-field">
                                    <div class="magic_lvl lvl_0">
                                        <h2>Truques</h2>
                                        <div class="lvl-content" id="lvl_0">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_0' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                                <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            </div>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_1">
                                        <h2>LVL 1</h2>
                                        <div class="lvl-content" id="lvl_1">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_1' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_2">
                                        <h2>LVL 2</h2>
                                        <div class="lvl-content" id="lvl_2">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_2' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_3">
                                        <h2>LVL 3</h2>
                                        <div class="lvl-content" id="lvl_3">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_3' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_4">
                                        <h2>LVL 4</h2>
                                        <div class="lvl-content" id="lvl_4">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_4' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_5">
                                        <h2>LVL 5</h2>
                                        <div class="lvl-content" id="lvl_5">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_5' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_6">
                                        <h2>LVL 6</h2>
                                        <div class="lvl-content" id="lvl_6">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_6' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_7">
                                        <h2>LVL 7</h2>
                                        <div class="lvl-content" id="lvl_7">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_7' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_8">
                                        <h2>LVL 8</h2>
                                        <div class="lvl-content" id="lvl_8">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_8' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_9">
                                        <h2>LVL 9</h2>
                                        <div class="lvl-content" id="lvl_9">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_9' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_10">
                                        <h2>Especial</h2>
                                        <div class="lvl-content" id="lvl_10">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_10' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" name="magic_attacks" value="">
                            </div>
                        </div>
                
                        <div class="popup-container" id="popup-container">
                            <div class="popup" id="popup">
                                <h2 id="popup-title"></h2>
                
                                <div class="popup-test">
                                    <p id="popup-p" class='popup-temp'></p>
                                    <p id="popup-p2" class='popup-temp'></p>
                
                                    <div class="popup-attackSection">
                                        <textarea id="popup-textarea" class="popup-temp" readonly></textarea>
                
                                        <label>
                                            Rolagens: <input type="number" id="times" min="1" max="100" value="1">
                                        </label>
                                    </div>
                                </div>
                
                                <button type="button" id="close_popup-button">Fechar</button>
                                <div class="popup-buttons" id="edit_attack-section">
                                    <button type="button" id="attack-button">Atacar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4">
                        <div class="choose-camp">
                            <div class="input-choose-camp">
                                <button id="before" class="input-choose-camp" type="button"><<</button>
                            </div>
                            <h3 id="camp-name">Descrição</h3>
                            <div class="input-choose-camp">
                                <button id="after" class="input-choose-camp" type="button">>></button>
                            </div>
                        </div>
                        <div class="general_informations">
                            <textarea name="characteristics_and_skills" id="_characteristics_and_skills"  class="characteristics_and_skills" readonly></textarea>
                            <textarea name="inventory"                  id="_inventory"                   class="characteristics_and_skills"></textarea>
                            <textarea name="description"                id="_history"                     class="characteristics_and_skills" readonly></textarea>
                        </div>
                    </div>
                    <div class="removeFromGame">
                        <button type="button" id="removeToken">Tirar do jogo</button>
                    </div>
                </div>
            </div>
        </div>
        <nav class="entity_nav">
            <a href="/new_entity/at-{{campaign.id}}" class="new_entity-button">Nova entidade</a>
        </nav>
    </div>

    <div class="notes-block">
        <div class="notes">
            <div class="choose-camp">
            <div class="input-choose-camp">
                <button id="notes-before" class="input-choose-camp" type="button"><<</button>
            </div>
            <h3 id="notes-camp-name">Anotações</h3>
            <div class="input-choose-camp">
                <button id="notes-after" class="input-choose-camp" type="button">>></button>
            </div>
            </div>
            <div class="general_informations">
                <textarea name="notes"                  id="_notes"               style="display: block"            class="inventory autosave">{{campaign.notes|default:""}}</textarea>
                <textarea name="history"                id="_campaign-history"    style="display: none"             class="inventory autosave">{{campaign.history|default:""}}</textarea>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block script %}
<script>
	//script para o popup

	const popupContainer = $('#popup-container')
	const popup = $('#popup')
	const closePopup_button = $('#close_popup-button')

	function openPopup(obj, attack=false) {
        $('#popup-title').text(obj.title)

        for (i in obj.query) {
            $('#popup-' + i).text(obj.query[i])
        }

		popupContainer.css('display', 'block')

        if (attack) {
            $('.popup-attackSection').add('#edit_attack-section').css('display', 'block')
            $('#popup').css('width', '50vw')
        } else {
            $('.popup-attackSection').add('#edit_attack-section').css('display', 'none')
            $('#popup').css('width', '20vw')
        }
	}

	function closePopup() {
        //limpar popup
        $('#times').val(1)
        $('.popup-temp').map((index, element)=> {
            element.innerText = null
        })

		popupContainer.css('display', 'none')
	}

	closePopup_button.on('click', closePopup)

	popupContainer.on('click', (event) => {
		if (event.target === popupContainer) {
			closePopup()
		}
	})
</script>

<script>
    //mostrar/esconder campos de magias

    $('.lvl-content').map((index, element)=> {
        const id = element.id

        if ($.trim($('#' + id).html()) === '') {
            $('.' + id).hide()
        } else {
            $('.' + id).show()
        }
    })
</script>

<script>
    //script para realizar testes de atributos e modificadores

    $('.modifier-input').map((index, element)=> {
        id = element.id
        $('#' + id).on('click', (event)=> {
            const value = parseInt($('#' + element.id).val())

            name = $('#_' + event.currentTarget.id.split('_')[0]).text()

            atributeTest(value, name)
        })
    })

    function atributeTest(value, name) {
        const roll = rollDice([[20, 1]], value)
        const inspiration = parseInt($('#inspiration').val())

        let obj = {
            p: 'Resultado: ' + roll,
        }

        if (inspiration != 0 || isNaN(inspiration)) {
            obj.p2 = 'Com inspiração: ' + (roll + parseInt($('#inspiration').val()))
            sendMessage(name + ' | ' + 'Resultado: ' + roll + ' | ' + 'Com inspiração: ' + (roll + parseInt($('#inspiration').val())))
        } else {
            sendMessage(name + ' | ' + 'Resultado: ' + roll)
        }

        openPopup({
            title: 'Teste de atributo',
            query: obj
        })
    }
</script>

<script>
    //script para salvaguardas e pericias

    $('.saveguard-input').add('.skill-input').map((index, element) => {
        const id = element.id
        
        $('#' + id).on('click', (event)=> {
            event.preventDefault()
            
            const el = $('#' + id)
            const value = !$(el).is(':checked')
            
            const allowed_ids = ['strength', 'dexterity', 'constituition', 'intelligence', 'wisdom', 'charisma']
            let type
            let title

            eventId = event.currentTarget.id.split('-')[0]
            name = $('label[for="' + eventId + '"]').text().split('-')[0].trim()


            if (allowed_ids.includes(id)) {
                type = id + '_modifier'
                title = 'Teste de salvaguarda'
            } else {
                type = id.split('-')[1] + '_modifier'
                title = 'Teste de pericia'
            }
            
            saveguard_and_skill_test(value, type, title, name)
        })
    })

    function saveguard_and_skill_test(proficiency, modifier_id, popup_title, name) {
        let value
        let value_i
        const modifier = $('#' + modifier_id).val()
        const proficiencyValue = $('#proeficiency').val()
        const inspiration = parseInt($('#inspiration').val())

        if (proficiency) {
            value = rollDice([[20, 1]], parseInt(modifier) + parseInt(proficiencyValue))
        } else {
            value = rollDice([[20, 1]], parseInt(modifier))
        }

        let obj = {
            p: 'Resultado: ' + value
        }

        if (inspiration != 0) {
            obj.p2 = 'Com inspiração: ' + (value + inspiration)
            console.log(value)
            console.log(inspiration)

            if (popup_title == 'Teste de salvaguarda') {
                sendMessage(name + ' (salvaguarda) | ' + 'Resultado: ' + value + ' | ' + 'Com inspiração: ' + (value + inspiration))
            } else {
                sendMessage(name + ' | ' + 'Resultado: ' + value + ' | ' + 'Com inspiração: ' + (value + inspiration))
            }
        } else {
            if (popup_title == 'Teste de salvaguarda') {
                sendMessage(name + ' (salvaguarda) | ' + 'Resultado: ' + value)
            } else {
                sendMessage(name + ' | ' + 'Resultado: ' + value)
            }
        }

        openPopup({
            title: popup_title,
            query: obj
        })

        
    }
</script>

<script>
    //script para ataques
    let attack
    let modifier
    let proeficiency

    function addAttack() {
        $('.attack').map((index, element) => {
            let id = element.id
            const type = id.split('_')[1]
            
            $('#' + element.id).on('click', ()=> {
                const idNumber = id.split('-')[1]
                attack = JSON.parse($('#attack_' + type + '_data-' + idNumber).val())
    
                switch (attack.attribute_modifier) {
                    case 'Nenhum':
                        modifier = 0
                        break
                    
                    case 'Força':
                        modifier = parseInt($('[name="strength_modifier"]').val())
                        break
    
                    case 'Destreza':
                        modifier = parseInt($('[name="dexterity_modifier"]').val())
                        break
    
                    case 'Constituição':
                        modifier = parseInt($('[name="constituition_modifier"]').val())
                        break
    
                    case 'Inteligência':
                        modifier = parseInt($('[name="intelligence_modifier"]').val())
                        break
    
                    case 'Sabedoria':
                        modifier = parseInt($('[name="wisdom_modifier"]').val())
                        break
    
                    case 'Carisma':
                        modifier = parseInt($('[name="charisma_modifier"]').val())
                        break
                }
    
                if (attack.proficiency) {
                    proeficiency = parseInt($('#proeficiency').val())
                } else {
                    proeficiency = 0
                }
    
                let formula = '';
                function appendToFormula(dice, roll) {
                    if (dice != 'Nenhum') {
                        formula += (formula ? ' + ' : '') + roll + dice
                    }
                }
    
                appendToFormula(attack.dice_1, attack.roll_1)
                appendToFormula(attack.dice_2, attack.roll_2)
                appendToFormula(attack.dice_3, attack.roll_3)
    
                let obj = {
                    p: 'Nome: ' + attack.name,
                    textarea: attack.description.replace(/\{\$br\$\}/g, "\n")
                }
    
                if (formula) {
                    obj.p2 = 'Fórmula: ' + formula
                }
    
                openPopup({
                    title: 'Opções de ataque',
                    query: obj
                }, true)
            })
        })
    }

    addAttack()

    $('#attack-button').on('click', ()=> {
        const times = $('#times').val()
        if (times < 0 || times == '') {
            return alert("Rolagens deve ser maior que 0")
        } else if (times > 10) {
            return alert("Rolagens deve ser menor que 10")
        }

        closePopup()
        
        let attackDice = []
        let damageDice = []
        for (i = 0; i < times; i++) {
            attackDice.push(rollDice([[20, 1]], modifier + proeficiency))

            if (attack.type == 'physical') {
                damageDice.push(rollDice([
                [parseInt(attack.dice_1.match(/\d+/)?.[0] ?? 0), attack.roll_1 ?? 0],
                [parseInt(attack.dice_2.match(/\d+/)?.[0] ?? 0), attack.roll_2 ?? 0],
                [parseInt(attack.dice_3.match(/\d+/)?.[0] ?? 0), attack.roll_3 ?? 0]
                ], attack.damage_modifier + modifier))
            }

            if (attack.type == 'magic') {
                damageDice.push(rollDice([
                [parseInt(attack.dice_1.match(/\d+/)?.[0] ?? 0), attack.roll_1 ?? 0],
                [parseInt(attack.dice_2.match(/\d+/)?.[0] ?? 0), attack.roll_2 ?? 0],
                [parseInt(attack.dice_3.match(/\d+/)?.[0] ?? 0), attack.roll_3 ?? 0]
                ], attack.damage_modifier))
            }
        }

        if (damageDice != 0) {
            openPopup({
                title: 'Ataque',
                query: {
                    p: 'Ataque: ' + attackDice,
                    p2: 'Dano: ' + damageDice
                }
            })
    
            sendMessage(attack.name + ' | ' + 'Ataque: '  + attackDice + ' | ' + 'Dano: ' + damageDice)
        } else {
            openPopup({
                title: 'Resultado',
                query: {
                    p: 'Resultado: ' + attackDice,
                }
            })

            sendMessage(attack.name + ' | ' + 'Resultado: '  + attackDice)
        }
    })
</script>

<script>
    $('#iniciative').on('click', ()=> {
        const result = rollDice([[20, 1]], parseInt($('#iniciative').val()))
        
        openPopup({
            title: 'Iniciativa',
            query: {
                p: 'Resultado: ' + result
            }
        })

        sendMessage('Iniciativa: ' + result)
    })
</script>

<script>
    //funções globais

    //inspiração
    var inspiration = parseInt($('#inspiration').val())
    $('#inspiration').on('change', ()=> {
        if ($('#inspiration').val() == '') {
            $('#inspiration').val(0)
        }

        inspiration = parseInt($('#inspiration').val())
    })

    //rolar dados
    function rollDice(type, modifier) {
        let sum = 0
        $.each(type, (index, value)=> {
            if (value[0] > 0) {
                for(let i = 0; i < value[1]; i++) {
                    sum += (Math.floor(Math.random() * value[0]) + 1)
                }
            }
        })

        const roll = sum + modifier;

        return roll
    }
</script>

<script>
    //script para colocar entidade em jogo
    let currentId
    let tempId = 0

    $('.entity-object').map((index, element)=> {
        $('#' + element.id).on('click', (event)=> {
            id = event.currentTarget.id

            createInstance(id)
        })
    })

    function createInstance(id) {
        name = $('#' + id).text()

        temp = '<div class="entity-nav" id="entity-nav-' + id + '_' + tempId + '">\n' +
            '<h4>' + name + '</h4>\n' +
            '<input type="hidden" id="subCharacteristcs-' + id + '_' + tempId + '">\n' +
            '</div>'

        if($('#entity-nav-' + id).length == 0) {
            $('.entity-navbar').append(temp)
            addToToken('entity-nav-' + id + '_' + tempId)
        }

        tempId++
    }

    function addToToken(id) {
        $('#' + id).on('click', (event)=> {
            saveSC()

            currentId = event.currentTarget.id

            rePaint(currentId)

            token = JSON.parse($('#token' + currentId.split('entity')[2].split('_')[0]).val())
            let subCharacteristcs
            try {
                subCharacteristcs = JSON.parse($('#subCharacteristcs-entity' + currentId.split('entity')[2]).val())
            } catch (exception) {
                subCharacteristcs = false
            }

            removePastAttacks()
            addInToken(token, subCharacteristcs)
        })

        function rePaint(id) {
            $('.entity-nav').map((index, element)=> {
                $('#' + element.id).css({
                    'background-color': 'white'
                })

                $('#' + id).css({
                    'background-color': 'gray'
                })
            })

            $('.entity_token-display').css('display', 'block')
            $('#_history').show()
            $('#_inventory').hide()
            $('#_characteristics_and_skills').hide()
            $('#camp-name').text('Descrição')

            campIndex = 2
        }

        function removePastAttacks() {
            $('.attack').each((index, element)=> {
                $('#' + element.id).remove()
                $('.magic_lvl').css('display', 'none')
            })
        }

        function addInToken(token, subCharacteristcs) {
            addAtributes(token.attributes)
            addCharacteristics(token.characteristics)
            addSkills(token.skills)
            addAttacks(token.attacks)

            function addAtributes(attributes) {
                const modifiers = Object.keys(attributes).filter((key) => {
                    return key.split('_')[1] == 'modifier'
                })
            
                for (let i = 0; i < modifiers.length; i++) {
                    let key = modifiers[i]
                    $('#' + key).val(attributes[key])
                }
            }

            function addCharacteristics(characteristics) {
                $('#_characteristics_and_skills').val(characteristics.characteristics_and_skills)
                $('#_inventory').val(characteristics.inventory)
                $('#_history').val(characteristics.history)

                $.each(characteristics, (index, element)=> {
                    $('#' + index).val(element)
                })

                if(!subCharacteristcs) {
                    let obj = {
                        'hp': characteristics.hp_max,
                        'class_armor': characteristics.class_armor,
                        'displacement': characteristics.displacement,
                        'iniciative': characteristics.iniciative,
                        'hp-temp': null,
                        'displacement-temp': null,
                        'ca-temp': null,
                        '_inventory': characteristics.inventory
                    }

                    $('#subCharacteristcs-entity' + currentId.split('entity')[2]).val(JSON.stringify(obj))
                }

                let obj = JSON.parse($('#subCharacteristcs-entity' + currentId.split('entity')[2]).val())

                $.each(obj, (index, element)=> {
                    $('#' + index).val(element)
                })
            }

            function addSkills(skills) {
                $('#inspiration').val(skills.inspiration)
                $('#proeficiency').val(skills.proeficiency)

                const all_skills = Object.keys(skills).filter((key) => {
                    return key.split('_')[1] == 'proeficiency'
                })

                for (let i = 0; i < all_skills.length; i++) {
                    let key = all_skills[i]
                    $('input[name="' + key + '"]').prop('checked', skills[key])
                }
            }

            function addAttacks(attacks) {
                let attack_num = 0

                for (key in attacks) {
                    if(attacks[key].type == 'physical') {
                        temp = '<div class="attack" id="attack_physical_config-' + attack_num + '">\n' +
                            '<h2>' + attacks[key].name + '</h2>\n' +
                            '<input type="hidden" id="attack_physical_data-' + attack_num + '" value=' + JSON.stringify(attacks[key]) + '>\n' +
                        '</div>'
    
                        $('.physical_attacks-field').append(temp)
                    }

                    if(attacks[key].type == 'magic') {
                        temp = '<div class="attack" id="attack_magic_config-' + attack_num + '">\n' +
                            '<h2>' + attacks[key].name + '</h2>\n' +
                            '<input type="hidden" id="attack_magic_data-' + attack_num + '" value=' + JSON.stringify(attacks[key]) + '>\n' +
                        '</div>'
                            
                        $('.' + attacks[key].magic_lvl).css('display', 'block')
                        $('#' + attacks[key].magic_lvl).append(temp)
                    }

                    attack_num++
                    addAttack()
                }
            }
        }

        function saveSC() {
            try {
                let obj = JSON.parse($('#subCharacteristcs-entity' + currentId.split('entity')[2]).val())
                $.each(obj, (index, element)=> {
                    value = $('#' + index).val()
                    obj[index] = value
                })

                obj.inventory = $('#_inventory').val()

                $('#subCharacteristcs-entity' + currentId.split('entity')[2]).val(JSON.stringify(obj))
            } catch (exception) {
                return
            }
        }
    }

    $('#removeToken').on('click', ()=> {
        $('.entity_token-display').css('display', 'none')
        $('#_history').css('display', 'none')
        $('#' + currentId).remove()
    })
</script>

<script>
    const sequenceCamp = [
        '_characteristics_and_skills',
        '_inventory',
        '_history'
    ]

    const sequenceCamp_trasnlated = [
        'Características e habilidades',
        'Inventário',
        'Descrição'
    ]

    const sequenceCamp_notes = [
        '_notes',
        '_campaign-history'
    ]

    const sequenceCamp_notes_trasnlated = [
        'Anotações',
        'História'
    ]

    var campIndex = 2
    let notes = 0

    $('#after').on('click', ()=> {
        let changeSelectet = campIndex + 1

        if(changeSelectet >= sequenceCamp.length) {
            changeSelectet = 0
        }

        change(changeSelectet)
    })

    $('#before').on('click', ()=> {
        let changeSelectet = campIndex - 1

        if(changeSelectet < 0) {
            changeSelectet = sequenceCamp.length -1
        }

        change(changeSelectet)
    })

    $('#notes-after').on('click', ()=> {
        let changeSelectet = notes + 1

        if(changeSelectet >= sequenceCamp_notes.length) {
            changeSelectet = 0
        }

        notesChange(changeSelectet)
    })

    $('#notes-before').on('click', ()=> {
        let changeSelectet = notes - 1

        if(changeSelectet < 0) {
            changeSelectet = sequenceCamp_notes.length -1
        }

        notesChange(changeSelectet)
    })

    function change(index) {
        for(key=0; key < sequenceCamp.length; key++) {
            $('#' + sequenceCamp[key]).css({
                'display': 'none'
            })
        }
        
        $('#' + sequenceCamp[index]).css({
            'display': 'block'
        })

        $('#camp-name').text(sequenceCamp_trasnlated[index])

        campIndex = index
    }

    function notesChange(index) {
        for(key=0; key < sequenceCamp_notes.length; key++) {
            $('#' + sequenceCamp_notes[key]).css({
                'display': 'none'
            })
        }
        
        $('#' + sequenceCamp_notes[index]).css({
            'display': 'block'
        })

        $('#notes-camp-name').text(sequenceCamp_notes_trasnlated[index])

        notes = index
    }
</script>

<script>
    //script para mensagens

    //enviar mensagem
    $('#sendMessageButton').on('click', ()=> {
        sendMessage($('#inputResponse').val())
        $('#inputResponse').val(null)
    })

    function sendMessage(input) {
        if (input.trim() != '') {
            $.ajax({
                type: 'POST',
                url: '/sendMessage/{{campaign.id}}/master/',
                data: {
                    'content': input
                }
            })
        }
    }

    //receber mensagem
    function getMessage() {
        $.ajax({
            type: 'GET',
            url: '/getMessage/{{campaign.id}}/',
            success: (response)=> {
                setMessagesInDisplay(response)
            }
        })
    }

    setInterval(getMessage, 500)

    //colocar mensagens no display
    let responseLength
    function setMessagesInDisplay(response) {
        if (response.payload.length == responseLength) {
            return
        }

        responseLength = response.payload.length
        $('#chat_display').html(null)

        for(key = 0; key < response.payload.length; key++) {
            let temp
            if (response.payload[key].owner_id == null) {
                temp = '<div class="master_message">\n' +
                    '<h3>Você</h3>\n' +
                    '<p>' + response.payload[key].content + '</p>\n' +
                    '</div>'
            } else {
                temp = '<div class="message">\n' +
                    '<h3>' + response.payload[key].username + '</h3>\n' +
                    '<p>' + response.payload[key].content + '</p>\n' +
                    '</div>'
            }

            $('#chat_display').append(temp)
            $('#chat_display').scrollTop($('#chat_display').prop("scrollHeight"))
        }
    }

    //enviar mensagem ao pressionar enter
    $('#inputResponse').keypress((event)=> {
        if (event.keyCode == 13) {
            $('#sendMessageButton').click()
        }
    })
</script>

<script>
    //script para rolagens de dados
    $('.dice').map((index, element)=> {
        $('#' + element.id).on('click', (event)=> {
            diceType = event.currentTarget.id
            diceValue = rollChatDice(diceType)

            sendMessage(diceType + ': ' + diceValue)
        })
    })

    //rolar dados
    function rollChatDice(type) {
        return Math.floor(Math.random() * type[0]) + 1
    }
</script>

<script>
    //salvamento automático dos campos
    $('.autosave').map((index, element) => {
        $('#' + element.id).on('input', () => {
            $.ajax({
                type: 'POST',
                url: '/campaign_autosave/{{campaign.id}}/' + element.name + '/',
                data: {
                    'value': element.value,
                }
            })
        })
    })
</script>
{% endblock %}