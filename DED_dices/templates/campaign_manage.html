{% extends 'base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/campaign_manage.css' %}">
<link rel="stylesheet" href="{% static 'css/chat.css' %}">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
{% endblock %}

{% block content %}
<header>
	<a class="back-button" href="/campaign_selection/"><</a>
	<a class="home-page" href="/">
		DED-dices
	</a>
</header>

<main>
    <div class="header">
        <h1>{{campaign.name}}</h1>
    </div>
    <div class="section_display">
        <div class="display_block">
            <h2>personagens</h2>
            <div class="block_content" id="players_display">
                {% for character in characters %}
                <a class="character" href="/play/{{character.id}}/">
                    <p>{{character.name}} - {{character.job}}</p>
                </a>
                {% endfor %}
            </div>
        </div>
        <div class="display_block">
            <h2>Chat</h2>
            <div class="block_content">
                <div id="chat_display"></div>

                <div id="chat_manager">
                    <div class="textInput">
                        <input type="text" name="response" id="inputResponse" maxlength="1000">
                        <button type="button" id="sendMessageButton">></div>
                    </div>
                    <div class="dices_manager">
                        <button type="button" class="dice" id="D4">D4</button>
                        <button type="button" class="dice" id="D6">D6</button>
                        <button type="button" class="dice" id="D8">D8</button>
                        <button type="button" class="dice" id="D10">D10</button>
                        <button type="button" class="dice" id="D12">D12</button>
                        <button type="button" class="dice" id="D20">D20</button>
                        <button type="button" class="dice" id="D100">D100</button>
                    </div>

                    {% csrf_token %}
                </div>
            </div>
        </div>
    </div>
    <div class="entity-manage">
        <h2>Gerenciador de entidades</h2>
        <div class="block_content" id="block_entity">
            <div class="your_entitys">
                <h3>Suas entidades</h3>
                <div class="your_entitys-display" id="entity_display">
                    {% for entity in entitys %}
                    <div class="entity">
                        <h4 class="entity-object" id="entity-{{entity.id}}">{{entity.name}}</h3>
                        <nav>
                            <a>Editar</a>
                            <a>Deletar</a>
                        </nav>

                        <input type="hidden" id="token-{{entity.id}}" value="{{entity.token}}">
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="entity_token">
                <div class="entity-navbar">

                </div>
                <div class="entity_token-display">
                    <div class="first-page">
                        <div class="col-1">
                            <div class="modifier">
                                <p id="_strength">Força</p>
                                <input type="number" name="strength_modifier" value="{{atributes.strength_modifier}}" class="modifier-input" readonly id="strength_modifier">
                            </div>
                
                            <div class="modifier">
                                <p id="_dexterity">Destreza</p>
                                <input type="number" name="dexterity_modifier" value="{{atributes.dexterity_modifier}}" class="modifier-input" readonly id="dexterity_modifier">
                            </div>
                
                            <div class="modifier">
                                <p id="_constituition">Constituição</p>
                                <input type="number" name="constituition_modifier" value="{{atributes.constituition_modifier}}" class="modifier-input" readonly id="constituition_modifier">
                            </div>
                
                            <div class="modifier">
                                <p id="_intelligence">Inteligência</p>
                                <input type="number" name="intelligence_modifier" value="{{atributes.intelligence_modifier}}" class="modifier-input" readonly id="intelligence_modifier">
                            </div>
                            
                            <div class="modifier">
                                <p id="_wisdom">Sabedoria</p>
                                <input type="number" name="wisdom_modifier" value="{{atributes.wisdom_modifier}}" class="modifier-input" readonly id="wisdom_modifier">
                            </div>
                            
                            <div class="modifier">
                                <p id="_charisma">Carisma</p>
                                <input type="number" name="charisma_modifier" value="{{atributes.charisma_modifier}}" class="modifier-input" readonly id="charisma_modifier">
                            </div>
                            
                        </div>

                        <div class="col-2">
                            <div class="body_statistics">
                                <div class="body_statistics-defined">
                                    <div class="body_statistic">
                                        <input type="number" name="ca" id="ca" value="{{characteristics.class_armor}}" required readonly>
                                        <p>CA</p>
                                    </div>
                                    <div class="body_statistic">
                                        <input type="number" name="iniciative" id="iniciative" value="{{characteristics.iniciative}}" required readonly>
                                        <p>Iniciativa</p>
                                    </div>
                                    <div class="body_statistic">
                                        <input type="number" name="displacement" id="displacement" value="{{characteristics.displacement}}" required readonly>
                                        <p>Deslocamento</p>
                                    </div>
                                    <div class="body_statistic">
                                        <input type="number" name="hp" class="autosave" id="hp" value="{{characteristics.hp}}" required>
                                        <p>HP</p>
                                    </div>
                                </div>
                                <div class="body_statistics-defined">
                                    <div class="body_statistic">
                                        <input type="number" name="class_armor_temp" class="autosave" id="ca-temp" value="{{characteristics.class_armor_temp}}" required>
                                        <p>CA - temp</p>
                                    </div>
                                    <div class="body_statistic">
                                        <input type="number" name="displacement_temp" class="autosave" id="displacement-temp" value="{{characteristics.displacement_temp}}" required>
                                        <p>Deslocamento - temp</p>
                                    </div>
                                    <div class="body_statistic">
                                        <input type="number" name="hp_temp" class="autosave" id="hp-temp" value="{{characteristics.hp_temp}}" required>
                                        <p>HP - temp</p>
                                    </div>
                                </div>
                            </div>
                
                            <div class="language_and_other_skills-field">
                                <textarea name="language_and_other_skills" readonly>{{characteristics.language_and_other_skills}}</textarea>
                                <p>Idiomas e outras proeficiências</p>
                            </div>
                
                            <div class="equipment-field">
                                <div class="equipment-content">
                                    <div class="money">
                                        <label class="money_category" for="pc">
                                            PC <input type="number" name="pc" class="autosave" id="pc" value="{{characteristics.pc}}">
                                        </label>
                                        <label class="money_category" for="pp">
                                            PP <input type="number" name="pp" class="autosave" id="pp" value="{{characteristics.pp}}">
                                        </label>
                                        <label class="money_category" for="po">
                                            PO <input type="number" name="po" class="autosave" id="po" value="{{characteristics.po}}">
                                        </label>
                                        <label class="money_category" for="pl">
                                            PL <input type="number" name="pl" class="autosave" id="pl" value="{{characteristics.pl}}">
                                        </label>
                                        <label class="money_category" for="da">
                                            DA <input type="number" name="da" class="autosave" id="da" value="{{characteristics.da}}">
                                        </label>
                                    </div>
                
                                    <textarea name="equipments" class="autosave" id="equipments">{{characteristics.equipments}}</textarea>
                                </div>
                
                                <p>Equipamentos</p>
                            </div>
                        </div>

                        <div class="col-3">
                            <div class="bonus">
                                <div class="inspiration">
                                    <input type="number" name="inspiration" class="autosave" value="{{skills.inspiration}}" id="inspiration">
                                    <p>Inspiração</p>
                                </div>
                                <div class="proeficiency">
                                    <input type="number" name="proeficiency" value="{{skills.proeficiency}}" readonly id="proeficiency">
                                    <p>Proeficiência</p>
                                </div>
                            </div>
                
                            <div class="saveguard">
                                <p>Testes de resistência</p>
                
                                <div class="saveguard-attribute">
                                    <input type="checkbox" name="strength_proeficiency" class="saveguard-input" id="strength" {% if skills.strength_proeficiency %}checked{% endif %}>
                                    <label for="strength">Força</label>
                                </div>
                                
                                <div class="saveguard-attribute">
                                    <input type="checkbox" name="dexterity_proeficiency" class="saveguard-input" id="dexterity" {% if skills.dexterity_proeficiency %}checked{% endif %}>
                                    <label for="dexterity">Destreza</label>
                                </div>
                                
                                <div class="saveguard-attribute">
                                    <input type="checkbox" name="constituition_proeficiency" class="saveguard-input" id="constituition" {% if skills.constituition_proeficiency %}checked{% endif %}>
                                    <label for="constituition">Constituição</label>
                                </div>
                                
                                <div class="saveguard-attribute">
                                    <input type="checkbox" name="intelligence_proeficiency" class="saveguard-input" id="intelligence" {% if skills.intelligence_proeficiency %}checked{% endif %}>
                                    <label for="intelligence">Inteligência</label>
                                </div>
                                
                                <div class="saveguard-attribute">
                                    <input type="checkbox" name="wisdom_proeficiency" class="saveguard-input" id="wisdom" {% if skills.wisdom_proeficiency %}checked{% endif %}>
                                    <label for="wisdom">Sabedoria</label>
                                </div>
                                
                                <div class="saveguard-attribute">
                                    <input type="checkbox" name="charisma_proeficiency" class="saveguard-input" id="charisma" {% if skills.charisma_proeficiency %}checked{% endif %}>
                                    <label for="charisma">Carisma</label>
                                </div>
                                
                            </div>
                
                            <div class="skills">
                                <p>Perícias</p>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="athletics_proeficiency" class="skill-input" id="athletics-strength" {% if skills.athletics_proeficiency %}checked{% endif %}>
                                    <label for="athletics">Atletismo - (For)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="stunt_proeficiency" class="skill-input" id="stunt-dexterity" {% if  skills.stunt_proeficiency %}checked{% endif %}>
                                    <label for="stunt">Acrobacia - (Des)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="stealth_proeficiency" class="skill-input" id="stealth-dexterity" {% if  skills.stealth_proeficiency %}checked{% endif %}>
                                    <label for="stealth">Furtividade - (Des)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="sleight_proeficiency" class="skill-input" id="sleight-dexterity" {% if  skills.sleight_proeficiency %}checked{% endif %}>
                                    <label for="sleight">Prestidigitação - (Des)</label>
                                </div>
                
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="arcana_proeficiency" class="skill-input" id="arcana-intelligence" {% if  skills.arcana_proeficiency %}checked{% endif %}>
                                    <label for="arcana">Arcanismo - (Int)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="history_proeficiency" class="skill-input" id="history-intelligence" {% if  skills.history_proeficiency %}checked{% endif %}>
                                    <label for="history">História - (Int)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="investigation_proeficiency" class="skill-input" id="investigation-intelligence" {% if  skills.investigation_proeficiency %}checked{% endif %}>
                                    <label for="investigation">Investigação - (Int)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="medicine_proeficiency" class="skill-input" id="medicine-intelligence" {% if  skills.medicine_proeficiency %}checked{% endif %}>
                                    <label for="medicine">Medicina - (Int)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="nature_proeficiency" class="skill-input" id="nature-intelligence" {% if  skills.nature_proeficiency %}checked{% endif %}>
                                    <label for="nature">Natureza - (Int)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="religion_proeficiency" class="skill-input" id="religion-intelligence" {% if  skills.religion_proeficiency %}checked{% endif %}>
                                    <label for="religion">Religião - (Int)</label>
                                </div>
                
                                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="acting_proeficiency" class="skill-input" id="acting-charisma" {% if  skills.acting_proeficiency %}checked{% endif %}>
                                    <label for="acting">Atuação - (Car)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="bluff_proeficiency" class="skill-input" id="bluff-charisma" {% if  skills.bluff_proeficiency %}checked{% endif %}>
                                    <label for="bluff">Blefar - (Car)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="intimidation_proeficiency" class="skill-input" id="intimidation-charisma" {% if  skills.intimidation_proeficiency %}checked{% endif %}>
                                    <label for="intimidation">Intimidação - (Car)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="intuition_proeficiency" class="skill-input" id="intuition-charisma" {% if  skills.intuition_proeficiency %}checked{% endif %}>
                                    <label for="intuition">Intuição - (Car)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="persuasion_proeficiency" class="skill-input" id="persuasion-charisma" {% if  skills.persuasion_proeficiency %}checked{% endif %}>
                                    <label for="persuasion">Persuasão - (Car)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="animal_proeficiency" class="skill-input" id="animal-wisdom" {% if  skills.animal_proeficiency %}checked{% endif %}>
                                    <label for="animal">Adestrar - (Sab)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="perception_proeficiency" class="skill-input" id="perception-wisdom" {% if  skills.perception_proeficiency %}checked{% endif %}>
                                    <label for="perception">Percepção - (Sab)</label>
                                </div>
                
                                <div class="skills-proeficiency">
                                    <input type="checkbox" name="survive_proeficiency" class="skill-input" id="survive-wisdom" {% if  skills.survive_proeficiency %}checked{% endif %}>
                                    <label for="survive">Sobrevivência - (Sab)</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="secound-page">
                        <div class="col-7">
                            <div class="physical_attacks">
                                <div class="attack-header">
                                    <h2>Ataques físicos</h2>
                                </div>
                                <div class="physical_attacks-field">
                                    {% for attack in attacks %}
                                    {% if attack.type == 'physical' %}
                                    <div class="attack" id="attack_physical_config-{{attack.id}}">
                                        <h2>{{attack.name}}</h2>
                                        <input type="hidden" id='attack_physical_data-{{attack.id}}' value='{"name": "{{attack.name}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                    </div>
                                    {% endif %}
                                    {% endfor %}
                                </div>
                                <input type="hidden" name="physical_attacks" value="">
                            </div>
                
                            <div class="magics_attacks">
                                <div class="attack-header">
                                    <h2>Ataques mágicos</h2>
                                </div>
                                <div class="magic_attacks-field">
                                    <div class="magic_lvl lvl_0">
                                        <h2>Truques</h2>
                                        <div class="lvl-content" id="lvl_0">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_0' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                                <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            </div>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_1">
                                        <h2>LVL 1</h2>
                                        <div class="lvl-content" id="lvl_1">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_1' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_2">
                                        <h2>LVL 2</h2>
                                        <div class="lvl-content" id="lvl_2">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_2' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_3">
                                        <h2>LVL 3</h2>
                                        <div class="lvl-content" id="lvl_3">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_3' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_4">
                                        <h2>LVL 4</h2>
                                        <div class="lvl-content" id="lvl_4">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_4' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_5">
                                        <h2>LVL 5</h2>
                                        <div class="lvl-content" id="lvl_5">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_5' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_6">
                                        <h2>LVL 6</h2>
                                        <div class="lvl-content" id="lvl_6">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_6' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_7">
                                        <h2>LVL 7</h2>
                                        <div class="lvl-content" id="lvl_7">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_7' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_8">
                                        <h2>LVL 8</h2>
                                        <div class="lvl-content" id="lvl_8">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_8' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_9">
                                        <h2>LVL 9</h2>
                                        <div class="lvl-content" id="lvl_9">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_9' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="magic_lvl lvl_10">
                                        <h2>Especial</h2>
                                        <div class="lvl-content" id="lvl_10">
                                            {% for attack in attacks %}
                                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_10' %}
                                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                                <h2>{{attack.name}}</h2>
                                            </div>
                                            <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" name="magic_attacks" value="">
                            </div>
                        </div>
                
                        <div class="popup-container" id="popup-container">
                            <div class="popup" id="popup">
                                <h2 id="popup-title"></h2>
                
                                <div class="popup-test">
                                    <p id="popup-p" class='popup-temp'></p>
                                    <p id="popup-p2" class='popup-temp'></p>
                
                                    <div class="popup-attackSection">
                                        <textarea id="popup-textarea" class="popup-temp" readonly></textarea>
                
                                        <label>
                                            Rolagens: <input type="number" id="times" min="1" max="100" value="1">
                                        </label>
                                    </div>
                                </div>
                
                                <button type="button" id="close_popup-button">Fechar</button>
                                <div class="popup-buttons" id="edit_attack-section">
                                    <button type="button" id="attack-button">Atacar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4">
                        <div class="choose-camp">
                        <div class="input-choose-camp">
                            <button id="before" class="input-choose-camp" type="button"><<</button>
                        </div>
                        <h3 id="camp-name">Descrição</h3>
                        <div class="input-choose-camp">
                            <button id="after" class="input-choose-camp" type="button">>></button>
                        </div>
                        </div>
                        <div class="general_informations">
                            <textarea name="characteristics_and_skills" id="_characteristics_and_skills"  class="characteristics_and_skills"></textarea>
                            <textarea name="inventory"                  id="_inventory"                   class="inventory"></textarea>
                            <textarea name="description"                id="_description"                 class="history"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <nav class="entity_nav">
            <a href="/new_entity/at-{{campaign.id}}" class="new_entity-button">Nova entidade</a>
        </nav>
    </div>
</main>
{% endblock %}

{% block script %}
<script>
    //script para colocar entidade em jogo

    $('.entity-object').map((index, element)=> {
        $('#' + element.id).on('click', (event)=> {
            id = event.currentTarget.id

            createInstance(id)
            addToToken(id)
        })
    })

    function createInstance(id) {
        name = $('#' + id).text()

        temp = '<div class="entity-nav" id="entity-nav-' + id + '">\n' +
            '<h4>' + name + '</h4>\n' +
            '</div>'

        if($('#entity-nav-' + id).length == 0) {
            $('.entity-navbar').append(temp)
        }
    }

    function addToToken(id) {
        $('#entity-nav-' + id).on('click', (event)=> {
            $('#' + event.currentTarget.id).css({
                'background-color': 'gray'
            })

            token = JSON.parse($('#token' + id.split('entity')[1]).val())
            console.log(token)
        })
    }
</script>

<script>
    const sequenceCamp = [
        'characteristics_and_skills',
        'inventory',
        'description'
    ]

    const sequenceCamp_trasnlated = [
        'Características e habilidades',
        'Inventário',
        'Descrição'
    ]

    let campIndex = 2

    $('#after').on('click', ()=> {
        let changeSelectet = campIndex + 1

        if(changeSelectet >= sequenceCamp.length) {
            changeSelectet = 0
        }

        change(changeSelectet)
    })

    $('#before').on('click', ()=> {
        let changeSelectet = campIndex - 1

        if(changeSelectet <= 0) {
            changeSelectet = sequenceCamp.length -1
        }

        change(changeSelectet)
    })

    function change(index) {
        console.log(sequenceCamp[index])
        console.log(index)
        for(key=0; key < sequenceCamp.length; key++) {
            $('#' + sequenceCamp[key]).css({
                'display': 'none'
            })
        }
        
        $('#' + sequenceCamp[index]).css({
            'display': 'block'
        })

        $('#camp-name').text(sequenceCamp_trasnlated[index])

        campIndex = index
    }
</script>

<script>
    //script para mensagens

    //enviar mensagem
    $('#sendMessageButton').on('click', ()=> {
        sendMessage($('#inputResponse').val())
        $('#inputResponse').val(null)
    })

    function sendMessage(input) {
        if (input.trim() != '') {
            $.ajax({
                type: 'POST',
                url: '/sendMessage/{{campaign.id}}/master/',
                data: {
                    'content': input
                }
            })
        }
    }

    //receber mensagem
    function getMessage() {
        $.ajax({
            type: 'GET',
            url: '/getMessage/{{campaign.id}}/',
            success: (response)=> {
                setMessagesInDisplay(response)
            }
        })
    }

    setInterval(getMessage, 500)

    //colocar mensagens no display
    let responseLength
    function setMessagesInDisplay(response) {
        if (response.payload.length == responseLength) {
            return
        }

        responseLength = response.payload.length
        $('#chat_display').html(null)

        for(key = 0; key < response.payload.length; key++) {
            let temp
            if (response.payload[key].owner_id == null) {
                temp = '<div class="master_message">\n' +
                    '<h3>Você</h3>\n' +
                    '<p>' + response.payload[key].content + '</p>\n' +
                    '</div>'
            } else {
                temp = '<div class="message">\n' +
                    '<h3>' + response.payload[key].username + '</h3>\n' +
                    '<p>' + response.payload[key].content + '</p>\n' +
                    '</div>'
            }

            $('#chat_display').append(temp)
            $('#chat_display').scrollTop($('#chat_display').prop("scrollHeight"))
        }
    }

    //enviar mensagem ao pressionar enter
    $('#inputResponse').keypress((event)=> {
        if (event.keyCode == 13) {
            $('#sendMessageButton').click()
        }
    })
</script>

<script>
    //script para rolagens de dados
    $('.dice').map((index, element)=> {
        $('#' + element.id).on('click', (event)=> {
            diceType = event.currentTarget.id
            diceValue = rollDice(diceType)

            sendMessage(diceType + ': ' + diceValue)
        })
    })

    //rolar dados
    function rollDice(type) {
        type = parseInt(type.match(/\d+/g)[0])
        
        return Math.floor(Math.random() * type) + 1
    }
</script>
{% endblock %}