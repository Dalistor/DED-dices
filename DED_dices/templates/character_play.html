{% extends 'base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" type="text/css" href="{% static 'css/chat.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/character_play.css' %}">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
{% endblock %}

{% block content %}
<header>
	<a class="back-button" href="{{ request.META.HTTP_REFERER }}"><</a>
	<a class="home-page" href="/">
		DED-dices
	</a>
</header>

<main>
    <div class="container">
        <div class="header">
            <input type="text" name="name" maxlength="30" value="{{character.name}}" class="character-name" readonly>
    
            <div class="character-upperFeatures">
                <input type="text" name="job" maxlength="50" value="{{character.job}}" class="upperFeatures" readonly>
                <input type="number" name="lvl" min="1" max="100" value="{{character.lvl}}" class="upperFeatures" readonly>
                <input type="text" name="background" maxlength="20" value="{{character.background}}" class="upperFeatures" readonly>
                <input type="text" name="race" maxlength="20" value="{{character.race}}" class="upperFeatures" readonly>
                <input type="number" name="experience" max="1000000000" value="{{character.experience}}" class="upperFeatures" readonly>
            </div>
        </div>
    
        <div class="first-page">
            <div class="col-1">
                <div class="modifier">
                    <p id="_strength">Força</p>
                    <input type="number" name="strength_modifier" value="{{atributes.strength_modifier}}" class="modifier-input" readonly id="strength_modifier">
                    <input type="number" name="strength_atribute" value="{{atributes.strength_atribute}}" class="atribute-input" readonly id="strength_atribute">
                </div>
    
                <div class="modifier">
                    <p id="_dexterity">Destreza</p>
                    <input type="number" name="dexterity_modifier" value="{{atributes.dexterity_modifier}}" class="modifier-input" readonly id="dexterity_modifier">
                    <input type="number" name="dexterity_atribute" value="{{atributes.dexterity_atribute}}" class="atribute-input" readonly id="dexterity_atribute">
                </div>
    
                <div class="modifier">
                    <p id="_constituition">Constituição</p>
                    <input type="number" name="constituition_modifier" value="{{atributes.constituition_modifier}}" class="modifier-input" readonly id="constituition_modifier">
                    <input type="number" name="constituition_atribute" value="{{atributes.constituition_atribute}}" class="atribute-input" readonly id="constituition_atribute">
                </div>
    
                <div class="modifier">
                    <p id="_intelligence">Inteligência</p>
                    <input type="number" name="intelligence_modifier" value="{{atributes.intelligence_modifier}}" class="modifier-input" readonly id="intelligence_modifier">
                    <input type="number" name="intelligence_atribute" value="{{atributes.intelligence_atribute}}" class="atribute-input" readonly id="intelligence_atribute">
                </div>
                
                <div class="modifier">
                    <p id="_wisdom">Sabedoria</p>
                    <input type="number" name="wisdom_modifier" value="{{atributes.wisdom_modifier}}" class="modifier-input" readonly id="wisdom_modifier">
                    <input type="number" name="wisdom_atribute" value="{{atributes.wisdom_atribute}}" class="atribute-input" readonly id="wisdom_atribute">
                </div>
                
                <div class="modifier">
                    <p id="_charisma">Carisma</p>
                    <input type="number" name="charisma_modifier" value="{{atributes.charisma_modifier}}" class="modifier-input" readonly id="charisma_modifier">
                    <input type="number" name="charisma_atribute" value="{{atributes.charisma_atribute}}" class="atribute-input" readonly id="charisma_atribute">
                </div>
                
            </div>
    
            <div class="col-2">
                <div class="bonus">
                    <div class="inspiration">
                        <input type="number" name="inspiration" class="autosave" value="{{skills.inspiration}}" id="inspiration">
                        <p>Inspiração</p>
                    </div>
                    <div class="proeficiency">
                        <input type="number" name="proeficiency" value="{{skills.proeficiency}}" readonly id="proeficiency">
                        <p>Proeficiência</p>
                    </div>
                </div>
    
                <div class="saveguard">
                    <p>Testes de resistência</p>
    
                    <div class="saveguard-attribute">
                        <input type="checkbox" name="strength_proeficiency" class="saveguard-input" id="strength" {% if skills.strength_proeficiency %}checked{% endif %}>
                        <label for="strength">Força</label>
                    </div>
                    
                    <div class="saveguard-attribute">
                        <input type="checkbox" name="dexterity_proeficiency" class="saveguard-input" id="dexterity" {% if skills.dexterity_proeficiency %}checked{% endif %}>
                        <label for="dexterity">Destreza</label>
                      </div>
                      
                      <div class="saveguard-attribute">
                        <input type="checkbox" name="constituition_proeficiency" class="saveguard-input" id="constituition" {% if skills.constituition_proeficiency %}checked{% endif %}>
                        <label for="constituition">Constituição</label>
                      </div>
                      
                      <div class="saveguard-attribute">
                        <input type="checkbox" name="intelligence_proeficiency" class="saveguard-input" id="intelligence" {% if skills.intelligence_proeficiency %}checked{% endif %}>
                        <label for="intelligence">Inteligência</label>
                      </div>
                      
                      <div class="saveguard-attribute">
                        <input type="checkbox" name="wisdom_proeficiency" class="saveguard-input" id="wisdom" {% if skills.wisdom_proeficiency %}checked{% endif %}>
                        <label for="wisdom">Sabedoria</label>
                      </div>
                      
                      <div class="saveguard-attribute">
                        <input type="checkbox" name="charisma_proeficiency" class="saveguard-input" id="charisma" {% if skills.charisma_proeficiency %}checked{% endif %}>
                        <label for="charisma">Carisma</label>
                      </div>
                    
                </div>
    
                <div class="skills">
                    <p>Perícias</p>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="athletics_proeficiency" class="skill-input" id="athletics-strength" {% if skills.athletics_proeficiency %}checked{% endif %}>
                        <label for="athletics">Atletismo - (For)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="stunt_proeficiency" class="skill-input" id="stunt-dexterity" {% if  skills.stunt_proeficiency %}checked{% endif %}>
                        <label for="stunt">Acrobacia - (Des)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="stealth_proeficiency" class="skill-input" id="stealth-dexterity" {% if  skills.stealth_proeficiency %}checked{% endif %}>
                        <label for="stealth">Furtividade - (Des)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="sleight_proeficiency" class="skill-input" id="sleight-dexterity" {% if  skills.sleight_proeficiency %}checked{% endif %}>
                        <label for="sleight">Prestidigitação - (Des)</label>
                    </div>
    
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="arcana_proeficiency" class="skill-input" id="arcana-intelligence" {% if  skills.arcana_proeficiency %}checked{% endif %}>
                        <label for="arcana">Arcanismo - (Int)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="history_proeficiency" class="skill-input" id="history-intelligence" {% if  skills.history_proeficiency %}checked{% endif %}>
                        <label for="history">História - (Int)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="investigation_proeficiency" class="skill-input" id="investigation-intelligence" {% if  skills.investigation_proeficiency %}checked{% endif %}>
                        <label for="investigation">Investigação - (Int)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="medicine_proeficiency" class="skill-input" id="medicine-intelligence" {% if  skills.medicine_proeficiency %}checked{% endif %}>
                        <label for="medicine">Medicina - (Int)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="nature_proeficiency" class="skill-input" id="nature-intelligence" {% if  skills.nature_proeficiency %}checked{% endif %}>
                        <label for="nature">Natureza - (Int)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="religion_proeficiency" class="skill-input" id="religion-intelligence" {% if  skills.religion_proeficiency %}checked{% endif %}>
                        <label for="religion">Religião - (Int)</label>
                    </div>
    
                    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="acting_proeficiency" class="skill-input" id="acting-charisma" {% if  skills.acting_proeficiency %}checked{% endif %}>
                        <label for="acting">Atuação - (Car)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="bluff_proeficiency" class="skill-input" id="bluff-charisma" {% if  skills.bluff_proeficiency %}checked{% endif %}>
                        <label for="bluff">Blefar - (Car)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="intimidation_proeficiency" class="skill-input" id="intimidation-charisma" {% if  skills.intimidation_proeficiency %}checked{% endif %}>
                        <label for="intimidation">Intimidação - (Car)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="intuition_proeficiency" class="skill-input" id="intuition-charisma" {% if  skills.intuition_proeficiency %}checked{% endif %}>
                        <label for="intuition">Intuição - (Car)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="persuasion_proeficiency" class="skill-input" id="persuasion-charisma" {% if  skills.persuasion_proeficiency %}checked{% endif %}>
                        <label for="persuasion">Persuasão - (Car)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="animal_proeficiency" class="skill-input" id="animal-wisdom" {% if  skills.animal_proeficiency %}checked{% endif %}>
                        <label for="animal">Adestrar - (Sab)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="perception_proeficiency" class="skill-input" id="perception-wisdom" {% if  skills.perception_proeficiency %}checked{% endif %}>
                        <label for="perception">Percepção - (Sab)</label>
                    </div>
    
                    <div class="skills-proeficiency">
                        <input type="checkbox" name="survive_proeficiency" class="skill-input" id="survive-wisdom" {% if  skills.survive_proeficiency %}checked{% endif %}>
                        <label for="survive">Sobrevivência - (Sab)</label>
                    </div>
                </div>
            </div>
    
    
            <div class="col-3">
                <div class="body_statistics">
                    <div class="body_statistics-defined">
                        <div class="body_statistic">
                            <input type="number" name="ca" id="ca" value="{{characteristics.class_armor}}" required readonly>
                            <p>CA</p>
                        </div>
                        <div class="body_statistic">
                            <input type="number" name="iniciative" id="iniciative" value="{{characteristics.iniciative}}" required readonly>
                            <p>Iniciativa</p>
                        </div>
                        <div class="body_statistic">
                            <input type="number" name="displacement" id="displacement" value="{{characteristics.displacement}}" required readonly>
                            <p>Deslocamento</p>
                        </div>
                        <div class="body_statistic">
                            <input type="number" name="hp" class="autosave" id="hp" value="{{characteristics.hp}}" required>
                            <p>HP</p>
                        </div>
                    </div>
                    <div class="body_statistics-defined">
                        <div class="body_statistic">
                            <input type="number" name="class_armor_temp" class="autosave" id="ca-temp" value="{{characteristics.class_armor_temp}}" required>
                            <p>CA - temp</p>
                        </div>
                        <div class="body_statistic">
                            <input type="number" name="displacement_temp" class="autosave" id="displacement-temp" value="{{characteristics.displacement_temp}}" required>
                            <p>Deslocamento - temp</p>
                        </div>
                        <div class="body_statistic">
                            <input type="number" name="hp_temp" class="autosave" id="hp-temp" value="{{characteristics.hp_temp}}" required>
                            <p>HP - temp</p>
                        </div>
                    </div>
                </div>
    
                <div class="language_and_other_skills-field">
                    <textarea name="language_and_other_skills" readonly>{{characteristics.language_and_other_skills}}</textarea>
                    <p>Idiomas e outras proeficiências</p>
                </div>
    
                <div class="equipment-field">
                    <div class="equipment-content">
                        <div class="money">
                            <label class="money_category" for="pc">
                                PC <input type="number" name="pc" class="autosave" id="pc" value="{{characteristics.pc}}">
                            </label>
                            <label class="money_category" for="pp">
                                PP <input type="number" name="pp" class="autosave" id="pp" value="{{characteristics.pp}}">
                            </label>
                            <label class="money_category" for="po">
                                PO <input type="number" name="po" class="autosave" id="po" value="{{characteristics.po}}">
                            </label>
                            <label class="money_category" for="pl">
                                PL <input type="number" name="pl" class="autosave" id="pl" value="{{characteristics.pl}}">
                            </label>
                            <label class="money_category" for="da">
                                DA <input type="number" name="da" class="autosave" id="da" value="{{characteristics.da}}">
                            </label>
                        </div>
    
                        <textarea name="equipments" class="autosave" id="equipments">{{characteristics.equipments}}</textarea>
                    </div>
    
                    <p>Equipamentos</p>
                </div>
            </div>
    
            <div class="col-4">
                <div class="choose-camp">
                  <div class="input-choose-camp">
                    <button id="before" class="input-choose-camp" type="button"><<</button>
                  </div>
                  <h3 id="camp-name">Inventário</h3>
                  <div class="input-choose-camp">
                    <button id="after" class="input-choose-camp" type="button">>></button>
                  </div>
                </div>
                <div class="general_informations">
                    <textarea name="appaerance"                 id="appaerance"                  class="appaerance" readonly>{{characteristics.appaerance}}</textarea>
                    <textarea name="ideals"                     id="ideals"                      class="ideals" readonly>{{characteristics.ideals}}</textarea>
                    <textarea name="ligations"                  id="ligations"                   class="ligations" readonly>{{characteristics.ligations}}</textarea>
                    <textarea name="defects"                    id="defects"                     class="defects" readonly>{{characteristics.defects}}</textarea>
                    <textarea name="characteristics_and_skills" id="characteristics_and_skills"  class="characteristics_and_skills" readonly>{{characteristics.characteristics_and_skills}}</textarea>
                    <textarea name="other_characteristics"      id="other_characteristics"       class="other_characteristics" readonly>{{characteristics.other_characteristics}}</textarea>
                    <textarea name="allies_and_organizations"   id="allies_and_organizations"    class="allies_and_organizations" readonly>{{characteristics.allies_and_organizations}}</textarea>
                    <textarea name="inventory"                  id="inventory"                   class="inventory autosave">{{characteristics.inventory}}</textarea>
                    <textarea name="history"                    id="history"                     class="history autosave">{{characteristics.history}}</textarea>
                </div>
            </div>
        </div>
    
        {% if campaign%}
        {% if not campaign.chat_private %}
        <div class="display_block">
            <h2>Chat</h2>
            <div class="block_content">
                <div id="chat_display"></div>
    
                <div id="chat_manager">
                    <div class="textInput">
                        <input type="text" name="response" id="inputResponse">
                        <button type="button" id="sendMessageButton">></div>
                    </div>
                    <div class="dices_manager">
                        <button type="button" class="dice" id="D4">D4</button>
                        <button type="button" class="dice" id="D6">D6</button>
                        <button type="button" class="dice" id="D8">D8</button>
                        <button type="button" class="dice" id="D10">D10</button>
                        <button type="button" class="dice" id="D12">D12</button>
                        <button type="button" class="dice" id="D20">D20</button>
                        <button type="button" class="dice" id="D100">D100</button>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        {% endif %}
    
        <div class="four-page">
            <div class="col-7">
                <div class="physical_attacks">
                    <div class="attack-header">
                        <h2>Ataques físicos</h2>
                    </div>
                    <div class="physical_attacks-field">
                        {% for attack in attacks %}
                        {% if attack.type == 'physical' %}
                        <div class="attack" id="attack_physical_config-{{attack.id}}">
                            <h2>{{attack.name}}</h2>
                            <input type="hidden" id='attack_physical_data-{{attack.id}}' value='{"name": "{{attack.name}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                    <input type="hidden" name="physical_attacks" value="">
                </div>
    
                <div class="magics_attacks">
                    <div class="attack-header">
                        <h2>Ataques mágicos</h2>
                    </div>
                    <div class="magic_attacks-field">
                        <div class="magic_lvl lvl_0">
                            <h2>Truques</h2>
                            <div class="lvl-content" id="lvl_0">
                                {% for attack in attacks %}
                                {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_0' %}
                                <div class="attack" id="attack_magic_config-{{attack.id}}">
                                    <h2>{{attack.name}}</h2>
                                    <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                </div>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="magic_lvl lvl_1">
                            <h2>LVL 1</h2>
                            <div class="lvl-content" id="lvl_1">
                                {% for attack in attacks %}
                                {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_1' %}
                                <div class="attack" id="attack_magic_config-{{attack.id}}">
                                    <h2>{{attack.name}}</h2>
                                </div>
                                <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="magic_lvl lvl_2">
                            <h2>LVL 2</h2>
                            <div class="lvl-content" id="lvl_2">
                                {% for attack in attacks %}
                                {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_2' %}
                                <div class="attack" id="attack_magic_config-{{attack.id}}">
                                    <h2>{{attack.name}}</h2>
                                </div>
                                <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="magic_lvl lvl_3">
                            <h2>LVL 3</h2>
                            <div class="lvl-content" id="lvl_3">
                                {% for attack in attacks %}
                                {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_3' %}
                                <div class="attack" id="attack_magic_config-{{attack.id}}">
                                    <h2>{{attack.name}}</h2>
                                </div>
                                <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="magic_lvl lvl_4">
                            <h2>LVL 4</h2>
                            <div class="lvl-content" id="lvl_4">
                                {% for attack in attacks %}
                                {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_4' %}
                                <div class="attack" id="attack_magic_config-{{attack.id}}">
                                    <h2>{{attack.name}}</h2>
                                </div>
                                <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="magic_lvl lvl_5">
                            <h2>LVL 5</h2>
                            <div class="lvl-content" id="lvl_5">
                                {% for attack in attacks %}
                                {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_5' %}
                                <div class="attack" id="attack_magic_config-{{attack.id}}">
                                    <h2>{{attack.name}}</h2>
                                </div>
                                <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="magic_lvl lvl_6">
                            <h2>LVL 6</h2>
                            <div class="lvl-content" id="lvl_6">
                                {% for attack in attacks %}
                                {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_6' %}
                                <div class="attack" id="attack_magic_config-{{attack.id}}">
                                    <h2>{{attack.name}}</h2>
                                </div>
                                <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="magic_lvl lvl_7">
                            <h2>LVL 7</h2>
                            <div class="lvl-content" id="lvl_7">
                                {% for attack in attacks %}
                                {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_7' %}
                                <div class="attack" id="attack_magic_config-{{attack.id}}">
                                    <h2>{{attack.name}}</h2>
                                </div>
                                <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="magic_lvl lvl_8">
                            <h2>LVL 8</h2>
                            <div class="lvl-content" id="lvl_8">
                                {% for attack in attacks %}
                                {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_8' %}
                                <div class="attack" id="attack_magic_config-{{attack.id}}">
                                    <h2>{{attack.name}}</h2>
                                </div>
                                <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="magic_lvl lvl_9">
                            <h2>LVL 9</h2>
                            <div class="lvl-content" id="lvl_9">
                                {% for attack in attacks %}
                                {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_9' %}
                                <div class="attack" id="attack_magic_config-{{attack.id}}">
                                    <h2>{{attack.name}}</h2>
                                </div>
                                <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="magic_lvl lvl_10">
                            <h2>Especial</h2>
                            <div class="lvl-content" id="lvl_10">
                                {% for attack in attacks %}
                                {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_10' %}
                                <div class="attack" id="attack_magic_config-{{attack.id}}">
                                    <h2>{{attack.name}}</h2>
                                </div>
                                <input type="hidden" id='attack_magic_data-{{attack.id}}' value='{"name": "{{attack.name}}", "magic_lvl": "{{attack.magic_lvl0}}", "dice_1": "{{attack.dice_1}}","dice_2": "{{attack.dice_2}}","dice_3": "{{attack.dice_3}}","roll_1": {%if attack.roll_1 %}{{attack.roll_1}}{% else %}null{% endif %},"roll_2": {%if attack.roll_2 %}{{attack.roll_2}}{% else %}null{% endif %},"roll_3": {%if attack.roll_3 %}{{attack.roll_3}}{% else %}null{% endif %},"damage_modifier": {%if attack.damage_modifier %}{{attack.damage_modifier}}{% else %}null{% endif %},"attribute_modifier": "{{attack.attribute_modifier}}","proficiency": {%if attack.proficiency %}true{% else %}false{% endif %},"description": "{{attack.description}}", "type": "{{attack.type}}"}'>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <input type="hidden" name="magic_attacks" value="">
                </div>
            </div>
    
            <div class="popup-container" id="popup-container">
                <div class="popup" id="popup">
                    <h2 id="popup-title"></h2>
    
                    <div class="popup-test">
                        <p id="popup-p" class='popup-temp'></p>
                        <p id="popup-p2" class='popup-temp'></p>
    
                        <div class="popup-attackSection">
                            <textarea id="popup-textarea" class="popup-temp" readonly></textarea>
    
                            <label>
                                Rolagens: <input type="number" id="times" min="1" max="100" value="1">
                            </label>
                        </div>
                    </div>
    
                    <button type="button" id="close_popup-button">Fechar</button>
                    <div class="popup-buttons" id="edit_attack-section">
                        <button type="button" id="attack-button">Atacar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block script %}
<script>
	//script para o popup

	const popupContainer = $('#popup-container')
	const popup = $('#popup')
	const closePopup_button = $('#close_popup-button')

	function openPopup(obj, attack=false) {
        $('#popup-title').text(obj.title)

        for (i in obj.query) {
            $('#popup-' + i).text(obj.query[i])
        }

		popupContainer.css('display', 'block')

        if (attack) {
            $('.popup-attackSection').add('#edit_attack-section').css('display', 'block')
            $('#popup').css('width', '50vw')
        } else {
            $('.popup-attackSection').add('#edit_attack-section').css('display', 'none')
            $('#popup').css('width', '20vw')
        }
	}

	function closePopup() {
        //limpar popup
        $('#times').val(1)
        $('.popup-temp').map((index, element)=> {
            element.innerText = null
        })

		popupContainer.css('display', 'none')
	}

	closePopup_button.on('click', closePopup)

	popupContainer.on('click', (event) => {
		if (event.target === popupContainer) {
			closePopup()
		}
	})
</script>

<script>
    //mostrar/esconder campos de magias

    $('.lvl-content').map((index, element)=> {
        const id = element.id

        if ($.trim($('#' + id).html()) === '') {
            $('.' + id).hide()
        } else {
            $('.' + id).show()
        }
    })
</script>

<script>
    //script para realizar testes de atributos e modificadores

    $('.modifier-input').map((index, element)=> {
        id = element.id
        $('#' + id).on('click', (event)=> {
            const value = parseInt($('#' + element.id).val())

            name = $('#_' + event.currentTarget.id.split('_')[0]).text()

            atributeTest(value, name)
        })
    })

    function atributeTest(value, name) {
        const roll = rollDice([[20, 1]], value)

        let obj = {
            p: 'Resultado: ' + roll,
        }

        if (inspiration != 0 || isNaN(inspiration)) {
            obj.p2 = 'Com inspiração: ' + (roll + parseInt($('#inspiration').val()))
            sendMessage(name + ' | ' + 'Resultado: ' + roll + ' | ' + 'Com inspiração: ' + (roll + parseInt($('#inspiration').val())))
        } else {
            sendMessage(name + ' | ' + 'Resultado: ' + roll)
        }

        openPopup({
            title: 'Teste de atributo',
            query: obj
        })
    }
</script>

<script>
    //script para salvaguardas e pericias

    $('.saveguard-input').add('.skill-input').map((index, element) => {
        const id = element.id
        
        $('#' + id).on('click', (event)=> {
            event.preventDefault()
            
            const el = $('#' + id)
            const value = !$(el).is(':checked')
            
            const allowed_ids = ['strength', 'dexterity', 'constituition', 'intelligence', 'wisdom', 'charisma']
            let type
            let title

            eventId = event.currentTarget.id.split('-')[0]
            name = $('label[for="' + eventId + '"]').text().split('-')[0].trim()


            if (allowed_ids.includes(id)) {
                type = id + '_modifier'
                title = 'Teste de salvaguarda'
            } else {
                type = id.split('-')[1] + '_modifier'
                title = 'Teste de pericia'
            }
            
            saveguard_and_skill_test(value, type, title, name)
        })
    })

    function saveguard_and_skill_test(proficiency, modifier_id, popup_title, name) {
        let value
        let value_i
        const modifier = $('#' + modifier_id).val()
        const proficiencyValue = $('#proeficiency').val()

        if (proficiency) {
            value = rollDice([[20, 1]], parseInt(modifier) + parseInt(proficiencyValue))
        } else {
            value = rollDice([[20, 1]], parseInt(modifier))
        }

        let obj = {
            p: 'Resultado: ' + value
        }

        if (inspiration != 0) {
            obj.p2 = 'Com inspiração: ' + (value + inspiration)

            if (popup_title == 'Teste de salvaguarda') {
                sendMessage(name + ' (salvaguarda) | ' + 'Resultado: ' + value + ' | ' + 'Com inspiração: ' + (value + inspiration))
            } else {
                sendMessage(name + ' | ' + 'Resultado: ' + value + ' | ' + 'Com inspiração: ' + (value + inspiration))
            }
        } else {
            if (popup_title == 'Teste de salvaguarda') {
                sendMessage(name + ' (salvaguarda) | ' + 'Resultado: ' + value)
            } else {
                sendMessage(name + ' | ' + 'Resultado: ' + value)
            }
        }

        openPopup({
            title: popup_title,
            query: obj
        })

        
    }
</script>

<script>
    //script para ataques
    let attack
    let modifier
    let proeficiency

    $('.attack').map((index, element) => {
        let id = element.id
        const type = id.split('_')[1]
        
        $('#' + element.id).on('click', ()=> {
            const idNumber = id.split('-')[1]
            attack = JSON.parse($('#attack_' + type + '_data-' + idNumber).val())

            switch (attack.attribute_modifier) {
                case 'Nenhum':
                    modifier = 0
                    break
                
                case 'Força':
                    modifier = parseInt($('[name="strength_modifier"]').val())
                    break

                case 'Destreza':
                    modifier = parseInt($('[name="dexterity_modifier"]').val())
                    break

                case 'Constituição':
                    modifier = parseInt($('[name="constituition_modifier"]').val())
                    break

                case 'Inteligência':
                    modifier = parseInt($('[name="intelligence_modifier"]').val())
                    break

                case 'Sabedoria':
                    modifier = parseInt($('[name="wisdom_modifier"]').val())
                    break

                case 'Carisma':
                    modifier = parseInt($('[name="charisma_modifier"]').val())
                    break
            }

            if (attack.proficiency) {
                proeficiency = parseInt($('#proeficiency').val())
            } else {
                proeficiency = 0
            }

            let formula = '';
            function appendToFormula(dice, roll) {
                if (dice != 'Nenhum') {
                    formula += (formula ? ' + ' : '') + roll + dice
                }
            }

            appendToFormula(attack.dice_1, attack.roll_1)
            appendToFormula(attack.dice_2, attack.roll_2)
            appendToFormula(attack.dice_3, attack.roll_3)

            let obj = {
                p: 'Nome: ' + attack.name,
                textarea: attack.description.replace(/\{\$br\$\}/g, "\n")
            }

            if (formula) {
                obj.p2 = 'Fórmula: ' + formula
            }

            openPopup({
                title: 'Opções de ataque',
                query: obj
            }, true)
        })
    })

    $('#attack-button').on('click', ()=> {
        const times = $('#times').val()
        if (times < 0 || times == '') {
            return alert("Rolagens deve ser maior que 0")
        } else if (times > 10) {
            return alert("Rolagens deve ser menor que 10")
        }

        closePopup()
        
        let attackDice = []
        let damageDice = []
        for (i = 0; i < times; i++) {
            attackDice.push(rollDice([[20, 1]], modifier + proeficiency))

            if (attack.type == 'physical') {
                damageDice.push(rollDice([
                [parseInt(attack.dice_1.match(/\d+/)?.[0] ?? 0), attack.roll_1 ?? 0],
                [parseInt(attack.dice_2.match(/\d+/)?.[0] ?? 0), attack.roll_2 ?? 0],
                [parseInt(attack.dice_3.match(/\d+/)?.[0] ?? 0), attack.roll_3 ?? 0]
                ], attack.damage_modifier + modifier))
            }

            if (attack.type == 'magic') {
                damageDice.push(rollDice([
                [parseInt(attack.dice_1.match(/\d+/)?.[0] ?? 0), attack.roll_1 ?? 0],
                [parseInt(attack.dice_2.match(/\d+/)?.[0] ?? 0), attack.roll_2 ?? 0],
                [parseInt(attack.dice_3.match(/\d+/)?.[0] ?? 0), attack.roll_3 ?? 0]
                ], attack.damage_modifier))
            }
        }

        if (damageDice != 0) {
            openPopup({
                title: 'Ataque',
                query: {
                    p: 'Ataque: ' + attackDice,
                    p2: 'Dano: ' + damageDice
                }
            })
    
            sendMessage(attack.name + ' | ' + 'Ataque: '  + attackDice + ' | ' + 'Dano: ' + damageDice)
        } else {
            openPopup({
                title: 'Resultado',
                query: {
                    p: 'Resultado: ' + attackDice,
                }
            })

            sendMessage(attack.name + ' | ' + 'Resultado: '  + attackDice)
        }
    })
</script>

<script>
    $('#iniciative').on('click', ()=> {
        const result = rollDice([[20, 1]], parseInt($('#iniciative').val()))
        
        openPopup({
            title: 'Iniciativa',
            query: {
                p: 'Resultado: ' + result
            }
        })

        sendMessage('Iniciativa: ' + result)
    })
</script>

<script>
    //funções globais

    //inspiração
    var inspiration = parseInt($('#inspiration').val())
    $('#inspiration').on('change', ()=> {
        if ($('#inspiration').val() == '') {
            $('#inspiration').val(0)
        }

        inspiration = parseInt($('#inspiration').val())
    })

    //rolar dados
    function rollDice(type, modifier) {
        let sum = 0
        $.each(type, (index, value)=> {
            if (value[0] > 0) {
                for(let i = 0; i < value[1]; i++) {
                    sum += (Math.floor(Math.random() * value[0]) + 1)
                }
            }
        })
        
        const roll = sum + modifier;

        return roll
    }
</script>

<script>
    //salvamento automático dos campos
    $('.autosave').map((index, element) => {
        $('#' + element.id).on('change', () => {
            $.ajax({
                type: 'POST',
                url: '/character_autosave/{{character.id}}/' + element.name + '/',
                data: {
                    'value': element.value,
                }
            })
        })
    })
</script>

<script>
    //dom
    const initialValue = {{characteristics.hp_max}}

    $('#hp').on('change', changeHPColor)
    changeHPColor()

    function changeHPColor() {
        let currentValue = parseInt($('#hp').val())
        if (currentValue < initialValue) {
            $('#hp').css('color', 'red')
        } else if (currentValue == initialValue) {
            $('#hp').css('color', 'black')
        } else {
            $('#hp').val(initialValue)
            $('#hp').css('color', 'black')
        }
    }
</script>

<script>
    //script para mensagens

    let character_id = '{{character.id}}'
    character_id = parseInt(character_id.split('-')[0])

    //enviar mensagem
    $('#sendMessageButton').on('click', ()=> {
        sendMessage($('#inputResponse').val())
        $('#inputResponse').val(null)
    })

    function sendMessage(input) {
        if (input.trim() != '') {
            $.ajax({
                type: 'POST',
                url: '/sendMessage/{{campaign.id}}/' + character_id + '/',
                data: {
                    'content': input
                }
            })
        }
    }

    {% if not campaign.chat_private %}
    //receber mensagem
    function getMessage() {
        $.ajax({
            type: 'GET',
            url: '/getMessage/{{campaign.id}}/',
            success: (response)=> {
                setMessagesInDisplay(response)
            }
        })
    }

    setInterval(getMessage, 500)
    {% endif %}

    //colocar mensagens no display
    let responseLength

    function setMessagesInDisplay(response) {
        if (response.payload.length == responseLength) {
            return
        }

        responseLength = response.payload.length
        $('#chat_display').html(null)

        for(key = 0; key < response.payload.length; key++) {
            let temp
            if (response.payload[key].owner_id == null) {
                temp = '<div class="master_message">\n' +
                    '<h3>Mestre</h3>\n' +
                    '<p>' + htmlToText(response.payload[key].content) + '</p>\n' +
                    '</div>'
            } else if (response.payload[key].owner_id == character_id) {
                temp = '<div class="your_message">\n' +
                    '<h3>Você</h3>\n' +
                    '<p>' + htmlToText(response.payload[key].content) + '</p>\n' +
                    '</div>'
            } else {
                temp = '<div class="message">\n' +
                    '<h3>' + htmlToText(response.payload[key].username) + '</h3>\n' +
                    '<p>' + htmlToText(response.payload[key].content) + '</p>\n' +
                    '</div>'
            }

            console.log(response)

            $('#chat_display').append(temp)
            $('#chat_display').scrollTop($('#chat_display').prop("scrollHeight"))
        }

        function htmlToText(html) {
            var div = document.createElement("div");
            div.innerHTML = html;
            return div.textContent || div.innerText || "";
        }
    }

    //enviar mensagem ao pressionar enter
    $('#inputResponse').keypress((event)=> {
        if (event.keyCode == 13) {
            $('#sendMessageButton').click()
        }
    })
</script>

<script>
    //script para rolagens de dados
    $('.dice').map((index, element)=> {
        $('#' + element.id).on('click', (event)=> {
            diceType = event.currentTarget.id
            diceValue = rollSingleDice(diceType)

            sendMessage(diceType + ': ' + diceValue)
        })
    })

    //rolar dados
    function rollSingleDice(type) {
        type = parseInt(type.match(/\d+/g)[0])
        
        return Math.floor(Math.random() * type) + 1
    }
</script>

<script>
    const sequenceCamp = [
        'appaerance',
        'ideals',
        'ligations',
        'defects',
        'characteristics_and_skills',
        'other_characteristics',
        'allies_and_organizations', 
        'inventory',
        'history'
    ]

    const sequenceCamp_trasnlated = [
        'Aparência',
        'Ideais',
        'Ligações',
        'Defeitos',
        'Características e habilidades',
        'Outras características',
        'Aliados e organizações', 
        'Inventário',
        'História'
    ]

    let campIndex = 7

    $('#after').on('click', ()=> {
        let changeSelectet = campIndex + 1

        if(changeSelectet >= sequenceCamp.length) {
            changeSelectet = 0
        }

        change(changeSelectet)
    })

    $('#before').on('click', ()=> {
        let changeSelectet = campIndex - 1

        if(changeSelectet <= 0) {
            changeSelectet = sequenceCamp.length -1
        }

        change(changeSelectet)
    })

    function change(index) {
        console.log(sequenceCamp[index])
        console.log(index)
        for(key=0; key < sequenceCamp.length; key++) {
            $('#' + sequenceCamp[key]).css({
                'display': 'none'
            })
        }
        
        $('#' + sequenceCamp[index]).css({
            'display': 'block'
        })

        $('#camp-name').text(sequenceCamp_trasnlated[index])

        campIndex = index
    }
</script>
{% endblock %}