{% extends 'base.html' %}
{% load static %}

{% block title %}
Seleção de Personagens
{% endblock %}

{% block head %}
<link rel="stylesheet" type="text/css" href="{% static 'css/character_play.css' %}">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
{% endblock %}

{% block content %}
<div class="container">
    <div class="header">
        <input type="text" name="name" maxlength="30" value="{{character.name}}" class="character-name" readonly>

        <div class="character-upperFeatures">
            <input type="text" name="job" maxlength="50" value="{{character.job}}" class="upperFeatures" readonly>
            <input type="number" name="lvl" min="1" max="100" value="{{character.lvl}}" class="upperFeatures" readonly>
            <input type="text" name="background" maxlength="20" value="{{character.background}}" class="upperFeatures" readonly>
            <input type="text" name="race" maxlength="20" value="{{character.race}}" class="upperFeatures" readonly>
            <input type="number" name="experience" max="1000000000" value="{{character.experience}}" class="upperFeatures" readonly>
        </div>
    </div>

    <div class="first-page">
        <div class="col-1">
            <div class="modifier">
                <p>Força</p>
                <input type="number" name="strength_modifier" value="{{atributes.strength_modifier}}" class="modifier-input" readonly id="strength_modifier">
                <input type="number" name="strength_atribute" value="{{atributes.strength_atribute}}" class="atribute-input" readonly id="strength_atribute">
            </div>

            <div class="modifier">
                <p>Destreza</p>
                <input type="number" name="dexterity_modifier" value="{{atributes.dexterity_modifier}}" class="modifier-input" readonly id="dexterity_modifier">
                <input type="number" name="dexterity_atribute" value="{{atributes.dexterity_atribute}}" class="atribute-input" readonly id="dexterity_atribute">
            </div>

            <div class="modifier">
                <p>Constituição</p>
                <input type="number" name="constituition_modifier" value="{{atributes.constituition_modifier}}" class="modifier-input" readonly id="constituition_modifier">
                <input type="number" name="constituition_atribute" value="{{atributes.constituition_atribute}}" class="atribute-input" readonly id="constituition_atribute">
            </div>

            <div class="modifier">
                <p>Inteligência</p>
                <input type="number" name="intelligence_modifier" value="{{atributes.intelligence_modifier}}" class="modifier-input" readonly id="intelligence_modifier">
                <input type="number" name="intelligence_atribute" value="{{atributes.intelligence_atribute}}" class="atribute-input" readonly id="intelligence_atribute">
            </div>
            
            <div class="modifier">
                <p>Sabedoria</p>
                <input type="number" name="wisdom_modifier" value="{{atributes.wisdom_modifier}}" class="modifier-input" readonly id="wisdom_modifier">
                <input type="number" name="wisdom_atribute" value="{{atributes.wisdom_atribute}}" class="atribute-input" readonly id="wisdom_atribute">
            </div>
            
            <div class="modifier">
                <p>Carisma</p>
                <input type="number" name="charisma_modifier" value="{{atributes.charisma_modifier}}" class="modifier-input" readonly id="charisma_modifier">
                <input type="number" name="charisma_atribute" value="{{atributes.charisma_atribute}}" class="atribute-input" readonly id="charisma_atribute">
            </div>
            
        </div>

        <div class="col-2">
            <div class="bonus">
                <div class="inspiration">
                    <input type="number" name="inspiration" class="autosave" value="{{skills.inspiration}}" id="inspiration">
                    <p>Inspiração</p>
                </div>
                <div class="proeficiency">
                    <input type="number" name="proeficiency" value="{{skills.proeficiency}}" readonly id="proeficiency">
                    <p>Proeficiência</p>
                </div>
            </div>

            <div class="saveguard">
                <p>Testes de resistência</p>

                <div class="saveguard-attribute">
                    <input type="checkbox" name="strength_proeficiency" class="saveguard-input" id="strength" {% if skills.strength_proeficiency %}checked{% endif %}>
                    <label for="strength">Força</label>
                </div>
                
                <div class="saveguard-attribute">
                    <input type="checkbox" name="dexterity_proeficiency" class="saveguard-input" id="dexterity" {% if skills.dexterity_proeficiency %}checked{% endif %}>
                    <label for="dexterity">Destreza</label>
                  </div>
                  
                  <div class="saveguard-attribute">
                    <input type="checkbox" name="constituition_proeficiency" class="saveguard-input" id="constituition" {% if skills.constituition_proeficiency %}checked{% endif %}>
                    <label for="constituition">Constituição</label>
                  </div>
                  
                  <div class="saveguard-attribute">
                    <input type="checkbox" name="intelligence_proeficiency" class="saveguard-input" id="intelligence" {% if skills.intelligence_proeficiency %}checked{% endif %}>
                    <label for="intelligence">Inteligência</label>
                  </div>
                  
                  <div class="saveguard-attribute">
                    <input type="checkbox" name="wisdom_proeficiency" class="saveguard-input" id="wisdom" {% if skills.wisdom_proeficiency %}checked{% endif %}>
                    <label for="wisdom">Sabedoria</label>
                  </div>
                  
                  <div class="saveguard-attribute">
                    <input type="checkbox" name="charisma_proeficiency" class="saveguard-input" id="charisma" {% if skills.charisma_proeficiency %}checked{% endif %}>
                    <label for="charisma">Carisma</label>
                  </div>
                
            </div>

            <div class="skills">
                <p>Perícias</p>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="athletics_proeficiency" class="skill-input" id="athletics-strength" {% if skills.athletics_proeficiency %}checked{% endif %}>
                    <label for="athletics">Atletismo - (For)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="stunt_proeficiency" class="skill-input" id="stunt-dexterity" {% if  skills.stunt_proeficiency %}checked{% endif %}>
                    <label for="stunt">Acrobacia - (Des)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="stealth_proeficiency" class="skill-input" id="stealth-dexterity" {% if  skills.stealth_proeficiency %}checked{% endif %}>
                    <label for="stealth">Furtividade - (Des)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="sleight_proeficiency" class="skill-input" id="sleight-dexterity" {% if  skills.sleight_proeficiency %}checked{% endif %}>
                    <label for="sleight">Prestidigitação - (Des)</label>
                </div>


                <div class="skills-proeficiency">
                    <input type="checkbox" name="arcana_proeficiency" class="skill-input" id="arcana-intelligence" {% if  skills.arcana_proeficiency %}checked{% endif %}>
                    <label for="arcana">Arcanismo - (Int)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="history_proeficiency" class="skill-input" id="history-intelligence" {% if  skills.history_proeficiency %}checked{% endif %}>
                    <label for="history">História - (Int)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="investigation_proeficiency" class="skill-input" id="investigation-intelligence" {% if  skills.investigation_proeficiency %}checked{% endif %}>
                    <label for="investigation">Investigação - (Int)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="medicine_proeficiency" class="skill-input" id="medicine-intelligence" {% if  skills.medicine_proeficiency %}checked{% endif %}>
                    <label for="medicine">Medicina - (Int)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="nature_proeficiency" class="skill-input" id="nature-intelligence" {% if  skills.nature_proeficiency %}checked{% endif %}>
                    <label for="nature">Natureza - (Int)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="religion_proeficiency" class="skill-input" id="religion-intelligence" {% if  skills.religion_proeficiency %}checked{% endif %}>
                    <label for="religion">Religião - (Int)</label>
                </div>

                
                <div class="skills-proeficiency">
                    <input type="checkbox" name="acting_proeficiency" class="skill-input" id="acting-charisma" {% if  skills.acting_proeficiency %}checked{% endif %}>
                    <label for="acting">Atuação - (Car)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="bluff_proeficiency" class="skill-input" id="bluff-charisma" {% if  skills.bluff_proeficiency %}checked{% endif %}>
                    <label for="bluff">Blefar - (Car)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="intimidation_proeficiency" class="skill-input" id="intimidation-charisma" {% if  skills.intimidation_proeficiency %}checked{% endif %}>
                    <label for="intimidation">Intimidação - (Car)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="intuition_proeficiency" class="skill-input" id="intuition-charisma" {% if  skills.intuition_proeficiency %}checked{% endif %}>
                    <label for="intuition">Intuição - (Car)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="persuasion_proeficiency" class="skill-input" id="persuasion-charisma" {% if  skills.persuasion_proeficiency %}checked{% endif %}>
                    <label for="persuasion">Persuasão - (Car)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="animal_proeficiency" class="skill-input" id="animal-wisdom" {% if  skills.animal_proeficiency %}checked{% endif %}>
                    <label for="animal">Adestrar - (Sab)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="perception_proeficiency" class="skill-input" id="perception-wisdom" {% if  skills.perception_proeficiency %}checked{% endif %}>
                    <label for="perception">Percepção - (Sab)</label>
                </div>

                <div class="skills-proeficiency">
                    <input type="checkbox" name="survive_proeficiency" class="skill-input" id="survive-wisdom" {% if  skills.survive_proeficiency %}checked{% endif %}>
                    <label for="survive">Sobrevivência - (Sab)</label>
                </div>
            </div>
        </div>


        <div class="col-3">
            <div class="body_statistics">
                <div class="body_statistics-defined">
                    <div class="body_statistic">
                        <input type="number" name="ca" id="ca" value="{{characteristics.class_armor}}" required readonly>
                        <p>CA</p>
                    </div>
                    <div class="body_statistic">
                        <input type="number" name="iniciative" id="iniciative" value="{{characteristics.iniciative}}" required readonly>
                        <p>iniciativa</p>
                    </div>
                    <div class="body_statistic">
                        <input type="number" name="displacement" id="displacement" value="{{characteristics.displacement}}" required readonly>
                        <p>Deslocamento</p>
                    </div>
                    <div class="body_statistic">
                        <input type="number" name="hp" class="autosave" id="hp" value="{{characteristics.hp}}" required>
                        <p>HP</p>
                    </div>
                </div>
                <div class="body_statistics-defined">
                    <div class="body_statistic">
                        <input type="number" name="class_armor_temp" class="autosave" id="ca-temp" value="{{characteristics.class_armor_temp}}" required>
                        <p>CA - temp</p>
                    </div>
                    <div class="body_statistic">
                        <input type="number" name="displacement_temp" class="autosave" id="displacement-temp" value="{{characteristics.displacement_temp}}" required>
                        <p>Deslocamento - temp</p>
                    </div>
                    <div class="body_statistic">
                        <input type="number" name="hp_temp" class="autosave" id="hp-temp" value="{{characteristics.hp_temp}}" required>
                        <p>HP - temp</p>
                    </div>
                </div>
            </div>

            <div class="language_and_other_skills-field">
                <textarea name="language_and_other_skills" readonly>{{characteristics.language_and_other_skills}}</textarea>
                <p>Idiomas e outras proeficiências</p>
            </div>

            <div class="equipment-field">
                <div class="equipment-content">
                    <div class="money">
                        <label class="money_category" for="pc">
                            PC <input type="number" name="pc" class="autosave" id="pc" value="{{characteristics.pc}}">
                        </label>
                        <label class="money_category" for="pp">
                            PP <input type="number" name="pp" class="autosave" id="pp" value="{{characteristics.pp}}">
                        </label>
                        <label class="money_category" for="po">
                            PO <input type="number" name="po" class="autosave" id="po" value="{{characteristics.po}}">
                        </label>
                        <label class="money_category" for="pl">
                            PL <input type="number" name="pl" class="autosave" id="pl" value="{{characteristics.pl}}">
                        </label>
                        <label class="money_category" for="da">
                            DA <input type="number" name="da" class="autosave" id="da" value="{{characteristics.da}}">
                        </label>
                    </div>

                    <textarea name="equipments" class="autosave" id="equipments">{{characteristics.equipments}}</textarea>
                </div>

                <p>Equipamentos</p>
            </div>
        </div>

        <div class="col-4">
            <div class="character-characteristics">
                <div class="characteristics">
                    <textarea name="ideals" readonly>{{characteristics.ideals}}</textarea>
                    <p>Ideais</p>
                </div>
                <div class="characteristics">
                    <textarea name="ligations" readonly>{{characteristics.ideals}}</textarea>
                    <p>Ligações</p>
                </div>
                <div class="characteristics">
                    <textarea name="defects" readonly>{{characteristics.ideals}}</textarea>
                    <p>Defeitos</p>
                </div>
            </div>

            <div class="characteristics_and_skills">
                <textarea name="characteristics_and_skills" readonly>{{characteristics.characteristics_and_skills}}</textarea>
                <p>Características e habilidades</p>
            </div>
        </div>
    </div>

    <div class="second-page">
        <div class="appaerance">
            <textarea name="appaerance" readonly>{{characteristics.appaerance}}</textarea>
            <p>Aparência</p>
        </div>
        <div class="other_characteristics">
            <textarea name="other_characteristics" readonly>{{characteristics.other_characteristics}}</textarea>
            <p>Outras características e habilidades</p>
        </div>

        <div class="allies_and_organizations">
            <textarea name="allies_and_organizations" readonly>{{characteristics.allies_and_organizations}}</textarea>
            <p>Aliados e organizações</p>
        </div>
        <div class="inventory">
            <textarea name="inventory" id="inventory" class="autosave">{{characteristics.inventory}}</textarea>
            <p>Inventário</p>
        </div>
    </div>

    <div class="third-page">
        <div class="col-6">
            <div class="history">
                <textarea name="history" id="history" class="autosave">{{characteristics.history}}</textarea>
                <p>História</p>
            </div>
        </div>
    </div>

    <div class="four-page">
        <div class="col-7">
            <div class="physical_attacks">
                <div class="attack-header">
                    <h2>Ataques físicos</h2>
                </div>
                <div class="physical_attacks-field">
                    {% for attack in attacks %}
                    {% if attack.type == 'physical' %}
                    <div class="attack" id="attack_physical_config-{{attack.id}}">
                        <h2>{{attack.name}}</h2>
                        <input type="hidden" id="attack_physical_data-{{attack.id}}" value="{'name': '{{attack.name}}','dice_1': '{{attack.dice_1}}','dice_2': '{{attack.dice_2}}','dice_3': '{{attack.dice_3}}','roll_1': {{attack.roll_1}},'roll_2': {{attack.roll_2}},'roll_3': {{attack.roll_3}},'damage_modifier': {{attack.damage_modifier}},'attribute_modifier': '{{attribute_modifier}}','proficiency': {{attack.proficiency}},'description': '{{attack.description}}'}">
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
                <input type="hidden" name="physical_attacks" value="">
            </div>

            <div class="magics_attacks">
                <div class="attack-header">
                    <h2>Ataques mágicos</h2>
                </div>
                <div class="magic_attacks-field">
                    <div class="magic_lvl lvl_0">
                        <h2>Truques</h2>
                        <div class="lvl-content" id="lvl_0">
                            {% for attack in attacks %}
                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_0' %}
                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                <h2>{{attack.name}}</h2>
                                <input type="hidden" id="attack_magic_data-{{attack.id}}" value="{'name': '{{attack.name}}' 'magic_lvl': '{{attack.magic_lvl}}','dice_1': '{{attack.dice_1}}','dice_2': '{{attack.dice_2}}','dice_3': '{{attack.dice_3}}','roll_1': {{attack.roll_1}},'roll_2': {{attack.roll_2}},'roll_3': {{attack.roll_3}},'damage_modifier': {{attack.damage_modifier}},'attribute_modifier': '{{attribute_modifier}}','proficiency': {{attack.proficiency}},'description': '{{attack.description}}'}">
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="magic_lvl lvl_1">
                        <h2>LVL 1</h2>
                        <div class="lvl-content" id="lvl_1">
                            {% for attack in attacks %}
                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_1' %}
                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                <h2>{{attack.name}}</h2>
                            </div>
                            <input type="hidden" id="attack_magic_data-{{attack.id}}" value="{'name': '{{attack.name}}' 'magic_lvl': '{{attack.magic_lvl}}','dice_1': '{{attack.dice_1}}','dice_2': '{{attack.dice_2}}','dice_3': '{{attack.dice_3}}','roll_1': {{attack.roll_1}},'roll_2': {{attack.roll_2}},'roll_3': {{attack.roll_3}},'damage_modifier': {{attack.damage_modifier}},'attribute_modifier': '{{attribute_modifier}}','proficiency': {{attack.proficiency}},'description': '{{attack.description}}'}">
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="magic_lvl lvl_2">
                        <h2>LVL 2</h2>
                        <div class="lvl-content" id="lvl_2">
                            {% for attack in attacks %}
                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_2' %}
                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                <h2>{{attack.name}}</h2>
                            </div>
                            <input type="hidden" id="attack_magic_data-{{attack.id}}" value="{'name': '{{attack.name}}' 'magic_lvl': '{{attack.magic_lvl}}','dice_1': '{{attack.dice_1}}','dice_2': '{{attack.dice_2}}','dice_3': '{{attack.dice_3}}','roll_1': {{attack.roll_1}},'roll_2': {{attack.roll_2}},'roll_3': {{attack.roll_3}},'damage_modifier': {{attack.damage_modifier}},'attribute_modifier': '{{attribute_modifier}}','proficiency': {{attack.proficiency}},'description': '{{attack.description}}'}">
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="magic_lvl lvl_3">
                        <h2>LVL 3</h2>
                        <div class="lvl-content" id="lvl_3">
                            {% for attack in attacks %}
                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_3' %}
                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                <h2>{{attack.name}}</h2>
                            </div>
                            <input type="hidden" id="attack_magic_data-{{attack.id}}" value="{'name': '{{attack.name}}' 'magic_lvl': '{{attack.magic_lvl}}','dice_1': '{{attack.dice_1}}','dice_2': '{{attack.dice_2}}','dice_3': '{{attack.dice_3}}','roll_1': {{attack.roll_1}},'roll_2': {{attack.roll_2}},'roll_3': {{attack.roll_3}},'damage_modifier': {{attack.damage_modifier}},'attribute_modifier': '{{attribute_modifier}}','proficiency': {{attack.proficiency}},'description': '{{attack.description}}'}">
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="magic_lvl lvl_4">
                        <h2>LVL 4</h2>
                        <div class="lvl-content" id="lvl_4">
                            {% for attack in attacks %}
                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_4' %}
                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                <h2>{{attack.name}}</h2>
                            </div>
                            <input type="hidden" id="attack_magic_data-{{attack.id}}" value="{'name': '{{attack.name}}' 'magic_lvl': '{{attack.magic_lvl}}','dice_1': '{{attack.dice_1}}','dice_2': '{{attack.dice_2}}','dice_3': '{{attack.dice_3}}','roll_1': {{attack.roll_1}},'roll_2': {{attack.roll_2}},'roll_3': {{attack.roll_3}},'damage_modifier': {{attack.damage_modifier}},'attribute_modifier': '{{attribute_modifier}}','proficiency': {{attack.proficiency}},'description': '{{attack.description}}'}">
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="magic_lvl lvl_5">
                        <h2>LVL 5</h2>
                        <div class="lvl-content" id="lvl_5">
                            {% for attack in attacks %}
                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_5' %}
                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                <h2>{{attack.name}}</h2>
                            </div>
                            <input type="hidden" id="attack_magic_data-{{attack.id}}" value="{'name': '{{attack.name}}' 'magic_lvl': '{{attack.magic_lvl}}','dice_1': '{{attack.dice_1}}','dice_2': '{{attack.dice_2}}','dice_3': '{{attack.dice_3}}','roll_1': {{attack.roll_1}},'roll_2': {{attack.roll_2}},'roll_3': {{attack.roll_3}},'damage_modifier': {{attack.damage_modifier}},'attribute_modifier': '{{attribute_modifier}}','proficiency': {{attack.proficiency}},'description': '{{attack.description}}'}">
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="magic_lvl lvl_6">
                        <h2>LVL 6</h2>
                        <div class="lvl-content" id="lvl_6">
                            {% for attack in attacks %}
                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_6' %}
                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                <h2>{{attack.name}}</h2>
                            </div>
                            <input type="hidden" id="attack_magic_data-{{attack.id}}" value="{'name': '{{attack.name}}' 'magic_lvl': '{{attack.magic_lvl}}','dice_1': '{{attack.dice_1}}','dice_2': '{{attack.dice_2}}','dice_3': '{{attack.dice_3}}','roll_1': {{attack.roll_1}},'roll_2': {{attack.roll_2}},'roll_3': {{attack.roll_3}},'damage_modifier': {{attack.damage_modifier}},'attribute_modifier': '{{attribute_modifier}}','proficiency': {{attack.proficiency}},'description': '{{attack.description}}'}">
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="magic_lvl lvl_7">
                        <h2>LVL 7</h2>
                        <div class="lvl-content" id="lvl_7">
                            {% for attack in attacks %}
                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_7' %}
                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                <h2>{{attack.name}}</h2>
                            </div>
                            <input type="hidden" id="attack_magic_data-{{attack.id}}" value="{'name': '{{attack.name}}' 'magic_lvl': '{{attack.magic_lvl}}','dice_1': '{{attack.dice_1}}','dice_2': '{{attack.dice_2}}','dice_3': '{{attack.dice_3}}','roll_1': {{attack.roll_1}},'roll_2': {{attack.roll_2}},'roll_3': {{attack.roll_3}},'damage_modifier': {{attack.damage_modifier}},'attribute_modifier': '{{attribute_modifier}}','proficiency': {{attack.proficiency}},'description': '{{attack.description}}'}">
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="magic_lvl lvl_8">
                        <h2>LVL 8</h2>
                        <div class="lvl-content" id="lvl_8">
                            {% for attack in attacks %}
                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_8' %}
                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                <h2>{{attack.name}}</h2>
                            </div>
                            <input type="hidden" id="attack_magic_data-{{attack.id}}" value="{'name': '{{attack.name}}' 'magic_lvl': '{{attack.magic_lvl}}','dice_1': '{{attack.dice_1}}','dice_2': '{{attack.dice_2}}','dice_3': '{{attack.dice_3}}','roll_1': {{attack.roll_1}},'roll_2': {{attack.roll_2}},'roll_3': {{attack.roll_3}},'damage_modifier': {{attack.damage_modifier}},'attribute_modifier': '{{attribute_modifier}}','proficiency': {{attack.proficiency}},'description': '{{attack.description}}'}">
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="magic_lvl lvl_9">
                        <h2>LVL 9</h2>
                        <div class="lvl-content" id="lvl_9">
                            {% for attack in attacks %}
                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_9' %}
                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                <h2>{{attack.name}}</h2>
                            </div>
                            <input type="hidden" id="attack_magic_data-{{attack.id}}" value="{'name': '{{attack.name}}' 'magic_lvl': '{{attack.magic_lvl}}','dice_1': '{{attack.dice_1}}','dice_2': '{{attack.dice_2}}','dice_3': '{{attack.dice_3}}','roll_1': {{attack.roll_1}},'roll_2': {{attack.roll_2}},'roll_3': {{attack.roll_3}},'damage_modifier': {{attack.damage_modifier}},'attribute_modifier': '{{attribute_modifier}}','proficiency': {{attack.proficiency}},'description': '{{attack.description}}'}">
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="magic_lvl lvl_10">
                        <h2>Especial</h2>
                        <div class="lvl-content" id="lvl_10">
                            {% for attack in attacks %}
                            {% if attack.type == 'magic' and attack.magic_lvl == 'lvl_10' %}
                            <div class="attack" id="attack_magic_config-{{attack.id}}">
                                <h2>{{attack.name}}</h2>
                            </div>
                            <input type="hidden" id="attack_magic_data-{{attack.id}}" value="{'name': '{{attack.name}}' 'magic_lvl': '{{attack.magic_lvl}}','dice_1': '{{attack.dice_1}}','dice_2': '{{attack.dice_2}}','dice_3': '{{attack.dice_3}}','roll_1': {{attack.roll_1}},'roll_2': {{attack.roll_2}},'roll_3': {{attack.roll_3}},'damage_modifier': {{attack.damage_modifier}},'attribute_modifier': '{{attribute_modifier}}','proficiency': {{attack.proficiency}},'description': '{{attack.description}}'}">
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <input type="hidden" name="magic_attacks" value="">
            </div>
        </div>

        <div class="popup-container" id="popup-container">
            <div class="popup" id="popup">
                <h2 id="popup-title"></h2>

                <div class="popup-test">
                    <p id="popup-p" class='popup-temp'></p>
                    <p id="popup-p2" class='popup-temp'></p>
                </div>

                <button type="button" id="close_popup-button">Fechar</button>
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block script %}
<script>
	//script para o popup

	const popupContainer = $('#popup-container')
	const popup = $('#popup')
	const closePopup_button = $('#close_popup-button')

	function openPopup(obj) {
        $('#popup-title').text(obj.title)

        for (i in obj.query) {
            $('#popup-' + i).text(obj.query[i])
        }

		popupContainer.css('display', 'block')
	}

	function closePopup() {
        //limpar popup

        $('.popup-temp').map((index, element)=> {
            element.innerText = null
        })

		popupContainer.css('display', 'none')
	}

	closePopup_button.on('click', closePopup)

	popupContainer.on('click', (event) => {
		if (event.target === popupContainer) {
			closePopup()
		}
	})
</script>

<script>
    //mostrar/esconder campos de magias

    $('.lvl-content').map((index, element)=> {
        const id = element.id

        if ($.trim($('#' + id).html()) === '') {
            $('.' + id).hide()
        } else {
            $('.' + id).show()
        }
    })
</script>

<script>
    //script para realizar testes de atributos e modificadores

    $('.modifier-input').map((index, element)=> {
        id = element.id
        $('#' + id).on('click', ()=> {
            const value = parseInt($('#' + id).val())
            atributeTest(value)
        })
    })

    function atributeTest(value) {
        const roll = rollDice(20, value)

        let obj = {
            p: 'Resultado: ' + roll,
        }

        if (inspiration != 0 || isNaN(inspiration)) {
            obj.p2 = 'Com inspiração: ' + (roll + parseInt($('#inspiration').val()))
        }

        openPopup({
            title: 'Teste de atributo',
            query: obj
        })
    }
</script>

<script>
    //script para salvaguardas e pericias

    $('.saveguard-input').add('.skill-input').map((index, element) => {
        const id = element.id
        
        $('#' + id).on('click', (event)=> {
            event.preventDefault()
            
            const el = $('#' + id)
            const value = !$(el).is(':checked')
            
            const allowed_ids = ['strength', 'dexterity', 'constituition', 'intelligence', 'wisdom', 'charisma']
            let type
            let title

            if (allowed_ids.includes(id)) {
                type = id + '_modifier'
                title = 'Teste de salvaguarda'
            } else {
                type = id.split('-')[1] + '_modifier'
                title = 'Teste de pericia'
            }
            
            saveguard_and_skill_test(value, type, title)
        })
    })

    function saveguard_and_skill_test(proficiency, modifier_id, popup_title) {
        let value
        let value_i
        const modifier = $('#' + modifier_id).val()
        const proficiencyValue = $('#proeficiency').val()

        if (proficiency) {
            value = rollDice(20, parseInt(modifier) + parseInt(proficiencyValue))
        } else {
            value = rollDice(20, parseInt(modifier))
        }

        let obj = {
            p: 'Resultado: ' + value
        }

        if (inspiration != 0) {
            obj.p2 = 'Com inspiração: ' + (value + inspiration)
        }

        openPopup({
            title: popup_title,
            query: obj
        })
    }
</script>

<script>
    //funções globais

    //inspiração
    var inspiration = parseInt($('#inspiration').val())
    $('#inspiration').on('change', ()=> {
        if ($('#inspiration').val() == '') {
            $('#inspiration').val(0)
        }

        inspiration = parseInt($('#inspiration').val())
    })

    //rolar dados
    function rollDice(type, modifier) {
        const roll = (Math.floor(Math.random() * type) + 1) + modifier;

        return roll
    }
</script>

<script>
    //salvamento automático dos campos
    $('.autosave').map((index, element) => {
        $('#' + element.id).on('change', () => {
            $.ajax({
                type: 'POST',
                url: '/character_autosave/{{character.id}}/' + element.name + '/',
                data: {
                    'value': element.value,
                }
            })
        })
    })
</script>

<script>
    //dom
    let initialValue = {{characteristics.hp_max}}

    $('#hp').on('change', changeHPColor)
    changeHPColor()

    function changeHPColor() {
        let currentValue = parseInt($('#hp').val())
        if (currentValue < initialValue) {
            $('#hp').css('color', 'red')
        } else if (currentValue == initialValue) {
            $('#hp').css('color', 'black')
        } else {
            $('#hp').val(initialValue)
            $('#hp').css('color', 'black')
        }
    }
</script>

<script>
    //script para ataques

    $('.attack').map((index, element) => {
        let id = element.id
        $('#' + element.id).on('click', (e)=> {
            console.log(id)
        })
    })
</script>
{% endblock %}